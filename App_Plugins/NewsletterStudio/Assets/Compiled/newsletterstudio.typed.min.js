"use strict";var umbraco,NewsletterStudio;function nsMenuActions(i,o){function s(e){return e.entity.id.split("_")[0]}return{CreateMailingList:function(e){var t=s(e);o.hideNavigation(),i.goToView("mailinglist-details","-1",t)},CreateCampaign:function(e){var t=s(e);o.hideNavigation(),i.goToView("campaign","-1",t)}}}!function(e){var t,i,o;t=e.directives||(e.directives={}),i=t.umbButton||(t.umbButton={}),(o=i.states||(i.states={})).init="init",o.busy="busy",o.success="success",o.error="error"}(umbraco=umbraco||{}),function(e){var t=(i.serverVariables=function(){return window.Umbraco.Sys.ServerVariables},i.getPreviewTransactionalUrl=function(e){return this.serverVariables().newsletterStudio.routes.renderPreviewTransactional+e},i.getPreviewCampaignUrl=function(e){return this.serverVariables().newsletterStudio.routes.renderPreviewCampaign+e},i.getRenderTrackingTransactionalEmailUrl=function(e){return this.serverVariables().newsletterStudio.routes.renderTrackingTransactionalEmail+e},i.getNsViewPath=function(e){return"/App_Plugins/NewsletterStudio"+e},i.getNsDirectiveViewPath=function(e){return this.getNsViewPath("/common/directives/"+e+"/"+e+".html")},i);function i(){}e.UmbracoFacade=t}(NewsletterStudio=NewsletterStudio||{}),function(e){!function(e){var t=(i.removeItem=function(e,t){var i=e.indexOf(t);return-1<i&&e.splice(i,1),e},i.isArray=function(e){return angular.isArray(e)},i);function i(){}e.Array=t;var o=(s.isValidEmail=function(e){return null!=e&&""!==e&&/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},s.toArrayOrRows=function(e){return(e=e.replace(/(\r\n|\r|\n)/g,"\n")).split("\n")},s.detectDelimiter=function(e){var t=e.split(",").length;return e.split(";").length<=t?",":";"},s.replaceTokens=function(e,t){if(t)for(var i=0;i<t.length;i++)e=e.replace("%"+i+"%",t[i]);return e},s.toFirstLower=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},s.toFirstUpper=function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e},s);function s(){}e.String=o;var r=(n.WrapPlaceholderAsMergeField=function(e,t){return t?"{{"+e+':"'+t+'"}}':"{{"+e+"}}"},n.ExtractPlaceholderFromMergeField=function(e){return e.substring(2,e.length-2)},n);function n(){}e.MergeFields=r;var a=(c.isNewsletterStudioProviderKey=function(e){return"ns_r_"===e.substr(0,5)},c.isUmbracoMemberProviderKey=function(e){return"umb_r_"===e.substr(0,6)},c.convertProviderIdToKey=function(e){return e.substr(5,e.length-5)},c.convertUmbracoProviderIdToKey=function(e){return e.substr(6,e.length-6)},c);function c(){}e.RecipientListProviders=a,e.isDefined=function(e){return angular.isDefined(e)},e.forEach=function(e,t,i){angular.forEach(e,t)},e.isNullOrEmpty=function(e){return!this.isDefined(e)||null===e||""===e}}(e.Utilities||(e.Utilities={}))}(NewsletterStudio=NewsletterStudio||{}),function(r){var e,t;function i(e,t,i){this.nsUiHelper=e,this.nsServiceHelper=t,this.$rootScope=i}e=r.Services||(r.Services={}),i.prototype.validate=function(e,t){return e.$valid?(e.$setPristine(),!0):(e.$$element.addClass("ns-errors-visible"),void 0!==t&&!1!==t||this.nsUiHelper.notificationError("ns_validationNotificationHeader","ns_validationNotificationMessage"),!1)},i.prototype.setErrors=function(o,e){var s=this;if(o.$$element.addClass("ns-errors-visible"),e&&e.data&&e.data.validationErrors&&(o.validationErrors=e.data.validationErrors),e&&e.data&&e.data.validationErrors){var t=e.data.validationErrors;r.Utilities.forEach(t,function(t){var i=r.Utilities.String.toFirstLower(t.property);s.$rootScope.$applyAsync(function(){var e=o[i];e&&(e.$error[t.errorAlias]=!0,e.$setValidity(t.errorAlias,!1))})})}},i.prototype.resetErrors=function(e){e&&(e.validationErrors=[],e.$setPristine())},i.$inject=["nsUiHelper","nsServiceHelper","$rootScope"],t=i,e.FormHelper=t,angular.module("umbraco").service("nsFormHelper",t)}(NewsletterStudio=NewsletterStudio||{}),angular.module("umbraco.services").factory("nsMenuActions",["nsLocation","navigationService",nsMenuActions]),function(s){var e,t;function i(e,t){this.localizationService=e,this.notificationsService=t}e=s.Services||(s.Services={}),i.prototype.notificationError=function(e,t,i){var o=this;this.localizationService.localizeMany([e,t]).then(function(e){o.notificationsService.error(s.Utilities.String.replaceTokens(e[0],i),s.Utilities.String.replaceTokens(e[1],i))})},i.$inject=["localizationService","notificationsService"],t=i,e.UiHelper=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){this.$http=e,this.serviceHelper=t,this.cacheCollection=[],this.maxCachedItem=500}t=e.Services||(e.Services={}),o.prototype.getAvatar=function(t,i){var o=this;this.serviceHelper.get("/Avatar/GetAvatar?email="+t,function(e){o.addToCache(t,e.data),i(e.data)})},o.prototype.getFromCache=function(e){for(var t=0;t<this.cacheCollection.length;t++)if(this.cacheCollection[t].email===e)return this.cacheCollection[t].images},o.prototype.addToCache=function(e,t){this.cacheCollection.push({email:e,images:t}),this.cacheCollection.length>this.maxCachedItem&&this.cacheCollection.shift()},o.$inject=["$http","nsServiceHelper"],i=o,t.AvatarService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){this.$http=e,this.serviceHelper=t}t=e.Services||(e.Services={}),o.prototype.getImageControlData=function(e,t,i){this.serviceHelper.post("/EmailEditor/GetImageControlData",e,t,i)},o.prototype.getMacros=function(e,t,i){var o={themeAlias:e};return this.serviceHelper.post("/EmailEditor/GetMacros",o,t,i),null},o.$inject=["$http","nsServiceHelper"],i=o,t.EmailEditorService=i}(NewsletterStudio=NewsletterStudio||{}),function(c){var e,t;function i(e,t,i,o,s,r,n,a){this.$location=e,this.$routeParams=t,this.navigationService=i,this.$route=o,this.$rootScope=s,this.$window=r,this.appState=n,this.treeService=a,this.umbracoPath=c.UmbracoFacade.serverVariables().umbracoSettings.umbracoPath}e=c.Services||(c.Services={}),i.prototype.pocUpdateSearch=function(e,t){var i=this.$rootScope.$on("$routeChangeStart",function(e){e.preventDefault(),i()});this.$location.search(e),t||this.$location.replace()},i.prototype.workspaceKey=function(){return c.Utilities.isDefined(this.$routeParams.id)?this.$routeParams.id:""},i.prototype.entityKey=function(){return this.$routeParams.e},i.prototype.setEntityKey=function(e){this.$location.search("e",e)},i.prototype.goToView=function(e,t,i){var o="/newsletterStudio/section/"+e+"/"+(c.Utilities.isNullOrEmpty(i)?this.workspaceKey():i);c.Utilities.isNullOrEmpty(t)?this.$location.path(o):this.$location.path(o).search("e",t)},i.prototype.goToUrl=function(e){this.$window.location.href=e},i.prototype.getViewPath=function(e,t,i){var o;o=i||this.workspaceKey();var s=this.umbracoPath+"/#/newsletterStudio/section/"+e+"/"+o;return c.Utilities.isNullOrEmpty(t)||(s=s+"?e="+t),s},i.prototype.setTreePath=function(e){var t,i=this;c.Utilities.isDefined(e)&&c.Utilities.isDefined(e.path)&&null!==e.path&&(t=e.path,i.navigationService.syncTree({tree:"section",path:t,forceReload:!0,activate:!0}))},i.prototype.refreshRootTree=function(){var e=this.appState.getTreeState("currentRootNode");this.treeService.loadNodeChildren({node:e.root,section:"newsletterStudio"})},i.prototype.refreshWorkspaceNode=function(e){var t=e+"_workspace",i=this.appState.getTreeState("currentRootNode").root.children.filter(function(e){return e.id==t}).shift();i&&this.treeService.reloadNode(i)},i.$inject=["$location","$routeParams","navigationService","$route","$rootScope","$window","appState","treeService"],t=i,e.LocationService=t}(NewsletterStudio=NewsletterStudio||{}),function(r){var e,t;function i(e,t,i){this.$http=e,this.notificationsService=t,this.localizationService=i}e=r.Services||(r.Services={}),i.prototype.handleErrorResponse=function(e,t){var i=this;if(500==e.status){if(e&&e.data&&e.data.exceptionMessage){var o=e.data.message+"<br/>Details: "+e.data.exceptionMessage;if(e.data.stackTrace){var s=750<e.data.stackTrace.length?750:e.data.stackTrace.length;o+="<br/><br/>"+e.data.stackTrace.substring(0,s)}this.localizationService.localize("general_error").then(function(e){i.notificationsService.error(e,o)}),r.Utilities.isDefined(t)&&t(e)}}else r.Utilities.isDefined(t)?t(e):this.showErrorNotification(e)},i.prototype.showErrorNotification=function(e){var t=this,i="An error has occurred";if(e&&e.data&&e.data.details){var o=e.data.details;o.translationKey?this.localizationService.localizeMany(["general_error",o.translationKey]).then(function(e){t.notificationsService.error(e[0],e[1])}):this.localizationService.localize("general_error").then(function(e){t.notificationsService.error(e,o.message)})}else e&&e.data&&e.data.message?i=e.data.message:"string"==typeof e.data?i=e.data:e&&e.message&&(i=e.message),this.localizationService.localize("general_error").then(function(e){t.notificationsService.error(e,i)})},i.prototype.buildUrl=function(e){return r.UmbracoFacade.serverVariables().umbracoSettings.umbracoPath+"/backoffice/NewsletterStudio"+e},i.prototype.get=function(e,t,i){var o=this;this.$http.get(this.buildUrl(e)).then(t,function(e){o.handleErrorResponse(e,i)})},i.prototype.post=function(e,t,i,o){var s=this;this.$http.post(this.buildUrl(e),t).then(i,function(e){s.handleErrorResponse(e,o)})},i.prototype.postWithState=function(e,t,i,o,s){var r=this;t&&(t.state=umbraco.directives.umbButton.states.busy),this.$http.post(this.buildUrl(e),i).then(function(e){t&&(t.state=umbraco.directives.umbButton.states.success),o(e)},function(e){t&&(t.state=umbraco.directives.umbButton.states.error),r.handleErrorResponse(e,s)})},i.prototype.upload=function(e,o,s,t,i){var r=this;this.$http({method:"POST",url:this.buildUrl(e),headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;t.append("model",angular.toJson(o));for(var i=0;i<s.length;i++)t.append("file"+i,s[i]);return t},data:{}}).then(t,function(e){r.handleErrorResponse(e,i)})},i.$inject=["$http","notificationsService","localizationService"],t=i,e.ServiceHelper=t}(NewsletterStudio=NewsletterStudio||{}),function(a){var e,t;function i(e,t,i,o,s){this.$http=e,this.serviceHelper=t,this.editorService=i,this.overlayService=o,this.localizationService=s}e=a.Services||(a.Services={}),i.prototype.openTransactionTrackingDetails=function(e){var t=this,i={title:"Transactional Details",size:"large",view:a.UmbracoFacade.getNsViewPath("/backoffice/dialogs/transactionalTrackingDetails/transactionalTrackingDetails.html"),close:function(){t.editorService.close()},submit:function(e){t.editorService.close()},data:{trackingTransactionalId:e}};this.editorService.open(i)},i.prototype.openTransactionalViewMessage=function(e){var t=this;$("body").addClass("ns-editors-600");var i={title:"View Message",size:"large",view:a.UmbracoFacade.getNsViewPath("/backoffice/dialogs/transactionalViewMessage/transactionalViewMessage.html"),close:function(){t.editorService.close(),$("body").removeClass("ns-editors-600")},submit:function(e){t.editorService.close(),$("body").removeClass("ns-editors-600")},data:{trackingTransactionalEmailId:e}};this.editorService.open(i)},i.prototype.openCampaignReportRecipientDetails=function(e,t,i,o,s){var r=this;$("body").addClass("ns-editors-600");var n={title:"Recipient interaction",size:"small",view:a.UmbracoFacade.getNsViewPath("/backoffice/dialogs/campaignReportRecipient/campaignReportRecipient.html"),close:function(){r.editorService.close(),$("body").removeClass("ns-editors-600"),s&&s()},submit:function(e){r.editorService.close(),$("body").removeClass("ns-editors-600"),o&&o(e)},data:{workspaceKey:i,campaignKey:e,providerRecipientId:t}};this.editorService.open(n)},i.prototype.openRecipientDetails=function(e,t,i,o){var s=this,r={title:"",size:"large",view:a.UmbracoFacade.getNsViewPath("/backoffice/dialogs/recipientDetails/recipientDetails.html"),close:function(){s.editorService.close(),o&&o()},submit:function(e){s.editorService.close(),i&&i(e)},data:{workspaceKey:e,recipientKey:t}};this.editorService.open(r)},i.prototype.openRecipientsImport=function(e,t,i,o){var s=this,r={title:"Import Recipients",size:"large",view:a.UmbracoFacade.getNsViewPath("/backoffice/dialogs/importRecipients/importRecipients.html"),close:function(){s.editorService.close(),o&&o()},submit:function(e){s.editorService.close(),i&&i(e)},data:{workspaceKey:e,mailingListKey:t}};this.editorService.open(r)},i.prototype.confirmation=function(i){var o=this;this.localizationService.localizeMany([i.titleLocalizationKey,i.descriptionLocalizationKey]).then(function(e){var t={view:a.UmbracoFacade.getNsViewPath("/backoffice/overlays/confirm.html"),title:a.Utilities.String.replaceTokens(e[0],i.tokenValues),data:{description:a.Utilities.String.replaceTokens(e[1],i.tokenValues)},submitButtonStyle:i.submitButtonStyle?i.submitButtonStyle:"danger",submitButtonLabelKey:i.submitButtonLabelKey?i.submitButtonLabelKey:"ns_remove",closeButtonLabelKey:i.closeButtonLabelKey?i.closeButtonLabelKey:"general_cancel",closeButtonLabel:"",submit:function(){i.confirm&&i.confirm(),o.overlayService.close()},close:function(){i.close&&i.close(),o.overlayService.close()}};o.overlayService.open(t)})},i.$inject=["$http","nsServiceHelper","editorService","overlayService","localizationService"],t=i,e.EditorService=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e){this.serviceHelper=e}t=e.Services||(e.Services={}),o.prototype.getOverview=function(e,t){this.serviceHelper.get("/Workspace/GetOverview",e,t)},o.prototype.getDashboardOverview=function(e,t,i){this.serviceHelper.get("/Workspace/GetDashboardOverview/"+e,t,i)},o.prototype.getSettings=function(e,t,i){this.serviceHelper.get("/Workspace/GetSettings/"+e,t,i)},o.prototype.saveSettings=function(e,t,i){this.serviceHelper.post("/Workspace/SaveSettings",e,t,i)},o.prototype.getManage=function(e,t,i){this.serviceHelper.get("/Workspace/GetManage/"+e,t,i)},o.prototype.saveManage=function(e,t,i){this.serviceHelper.post("/Workspace/SaveManage",e,t,i)},o.prototype.createNew=function(e,t,i){this.serviceHelper.post("/Workspace/CreateNew",e,t,i)},o.prototype.remove=function(e,t,i){this.serviceHelper.get("/Workspace/Remove/"+e,t,i)},o.prototype.licensesGet=function(e,t,i){this.serviceHelper.post("/Workspace/LicenseLogin",e,t,i)},o.prototype.licenseConnect=function(e,t,i){this.serviceHelper.post("/Workspace/LicenseConnect",e,t,i)},o.prototype.testPop3Server=function(e,t,i,o){this.serviceHelper.postWithState("/Workspace/TestPop3Server",t,e,i,o)},o.$inject=["nsServiceHelper"],i=o,t.WorkspaceService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){this.$http=e,this.serviceHelper=t}t=e.Services||(e.Services={}),o.prototype.getByKey=function(e,t,i,o){this.serviceHelper.get("/Campaign/GetByKey/"+t+"?e="+e,i,o)},o.prototype.getRecipientLists=function(e,t,i){this.serviceHelper.get("/Campaign/GetRecipientLists/"+e,t,i)},o.prototype.getOverviewForWorkspace=function(e,t,i){this.serviceHelper.get("/Campaign/GetOverview/"+e,t,i)},o.prototype.getPagedCampaignListItems=function(e,t,i){this.serviceHelper.post("/Campaign/GetPagedCampaignListItems",e,t,i)},o.prototype.sendTestEmail=function(e,t,i){this.serviceHelper.post("/Campaign/SendTestEmail",e,t,i)},o.prototype.save=function(e,t,i){this.serviceHelper.post("/Campaign/Save",e,t,i)},o.prototype.saveWithState=function(e,t,i,o){this.serviceHelper.postWithState("/Campaign/Save",t,e,i,o)},o.prototype.saveAndSendOrSchedule=function(e,t,i){this.serviceHelper.post("/Campaign/saveAndSendOrSchedule",e,t,i)},o.prototype.delete=function(e,t,i,o){this.serviceHelper.post("/Campaign/Delete/"+e+"?e="+t,null,i,o)},o.prototype.duplicate=function(e,t,i,o){this.serviceHelper.post("/Campaign/Duplicate/"+e+"?e="+t,null,i,o)},o.$inject=["$http","nsServiceHelper"],i=o,t.CampaignService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){this.$http=e,this.serviceHelper=t}t=e.Services||(e.Services={}),o.prototype.createCampaignFrom=function(e,t,i){this.serviceHelper.get("/CampaignContentApp/CreateCampaignFrom/"+e,t,i)},o.prototype.getOverviewFor=function(e,t,i){this.serviceHelper.get("/CampaignContentApp/GetOverviewFor/"+e,t,i)},o.prototype.getByKey=function(e,t,i){this.serviceHelper.get("/CampaignContentApp/GetByKey/"+e,t,i)},o.prototype.sendTestEmail=function(e,t,i){this.serviceHelper.post("/CampaignContentApp/SendTestEmail",e,t,i)},o.prototype.save=function(e,t,i){this.serviceHelper.post("/CampaignContentApp/Save",e,t,i)},o.prototype.saveAndSendOrSchedule=function(e,t,i){this.serviceHelper.post("/CampaignContentApp/SaveAndSendOrSchedule",e,t,i)},o.$inject=["$http","nsServiceHelper"],i=o,t.CampaignContentAppService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){this.$http=e,this.serviceHelper=t}t=e.Services||(e.Services={}),o.prototype.getOverviewFor=function(e,t,i,o){this.serviceHelper.get("/CampaignReport/GetOverview/"+t+"?ws="+e,i,o)},o.prototype.getRecipients=function(e,t,i){this.serviceHelper.post("/CampaignReport/GetRecipients",e,t,i)},o.prototype.getRecipientTimeline=function(e,t,i,o){this.serviceHelper.get("/CampaignReport/getRecipientTimeline/"+e+"?pri="+t,i,o)},o.$inject=["$http","nsServiceHelper"],i=o,t.CampaignReportService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e){this.serviceHelper=e}t=e.Services||(e.Services={}),o.prototype.getTransactionalOverview=function(e,t,i){this.serviceHelper.get("/Transactional/GetTransactionalOverview/"+e,t,i)},o.prototype.getTrackingTransactional=function(e,t,i){this.serviceHelper.get("/Transactional/GetTrackingTransactional/"+e,t,i)},o.prototype.getTransactionalEmailsOverview=function(e,t,i){this.serviceHelper.get("/Transactional/GetTransactionalEmailsOverview/"+e,t,i)},o.prototype.getPagedTransactionalListItems=function(e,t,i){this.serviceHelper.post("/Transactional/GetPagedTransactionalListItems",e,t,i)},o.prototype.getPagedTransactionalLogItems=function(e,t,i){this.serviceHelper.post("/Transactional/GetPagedTransactionalLogItems",e,t,i)},o.prototype.getDetails=function(e,t,i,o){this.serviceHelper.get("/Transactional/GetDetails/"+e+"?e="+t,i,o)},o.prototype.delete=function(e,t,i,o){this.serviceHelper.post("/Transactional/Delete/"+e+"?e="+t,null,i,o)},o.prototype.duplicate=function(e,t,i,o){this.serviceHelper.post("/Transactional/Duplicate/"+e+"?e="+t,null,i,o)},o.prototype.getFieldsByAlias=function(e,t,i){this.serviceHelper.get("/Transactional/GetFieldsByAlias/"+e,t,i)},o.prototype.sendTestEmail=function(e,t,i,o){this.serviceHelper.postWithState("/Transactional/SendTestEmail",t,e,i,o)},o.prototype.save=function(e,t,i,o){this.serviceHelper.postWithState("/Transactional/Save",t,e,i,o)},o.$inject=["nsServiceHelper"],i=o,t.TransactionalService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e){this.serviceHelper=e}t=e.Services||(e.Services={}),o.prototype.getOverviewForWorkspace=function(e,t,i){this.serviceHelper.get("/MailingList/GetOverview/"+e,t,i)},o.prototype.getDetails=function(e,t,i,o,s,r,n){this.serviceHelper.get("/MailingList/GetDetails/"+e+"?e="+t+"&st="+i+"&s="+o+"&p="+s,r,n)},o.prototype.getPagedSubscribers=function(e,t,i,o,s,r,n){this.serviceHelper.get("/MailingList/GetPagedSubscribers/"+e+"?e="+t+"&searchText="+i+"&status="+o+"&page="+s,r,n)},o.prototype.save=function(e,t,i){this.serviceHelper.post("/MailingList/Save",e,t,i)},o.prototype.remove=function(e,t,i){this.serviceHelper.post("/MailingList/Remove/"+e,null,t,i)},o.$inject=["nsServiceHelper"],i=o,t.MailingListService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e){this.serviceHelper=e}t=e.Services||(e.Services={}),o.prototype.getOverviewForWorkspace=function(e,t,i){this.serviceHelper.get("/Recipient/GetOverview/"+e,t,i)},o.prototype.getPagedRecipients=function(e,t,i,o,s,r){this.serviceHelper.get("/Recipient/GetPagedRecipients/"+e+"?searchText="+t+"&filter="+i+"&page="+o,s,r)},o.prototype.getDetails=function(e,t,i,o){this.serviceHelper.get("/Recipient/GetDetails/"+e+"?recipientKey="+t,i,o)},o.prototype.saveRecipientDetails=function(e,t,i){this.serviceHelper.post("/Recipient/saveRecipientDetails",e,t,i)},o.prototype.resetErrorsForRecipient=function(e,t,i){this.serviceHelper.get("/Recipient/resetErrorsForRecipient/"+e,t,i)},o.prototype.remove=function(e,t,i){this.serviceHelper.get("/Recipient/Remove/"+e,t,i)},o.$inject=["nsServiceHelper"],i=o,t.RecipientService=i}(NewsletterStudio=NewsletterStudio||{}),function(o){var e,t;function i(e,t,i){this.$rootScope=e,this.$q=t,this.assetsService=i,this.starting=!1,this.callbacks=[],this.callbackMaps=[],this.scripts=[o.UmbracoFacade.serverVariables().umbracoSettings.umbracoPath+"/lib/signalr/signalr.min.js"]}e=o.Services||(o.Services={}),i.prototype.initHub=function(e){var t=this;if(this.callbacks.push(e),!this.starting)if(void 0===window.$.connection){this.starting=!0;var i=[];this.scripts.forEach(function(e){i.push(t.assetsService.loadJs(e))}),this.$q.all(i).then(function(){for(;t.callbacks.length;){var e=t.callbacks.pop();t.hubSetup(e)}t.starting=!1})}else{for(;this.callbacks.length;){var o=this.callbacks.pop();this.hubSetup(o)}this.starting=!1}},i.prototype.hubSetup=function(e){var t,o=this,s=null!==(t=window.$)&&void 0!==t?t:{};if(null==s.connection&&(s.connection=(new signalR.HubConnectionBuilder).withUrl(Umbraco.Sys.ServerVariables.newsletterStudio.routes.hub).withAutomaticReconnect().configureLogging(signalR.LogLevel.Warning).build()),void 0!==s.connection)return e({start:function(){"Connected"!==s.connection.connectionState&&s.connection.start()},on:function(e,t){var i={callback:t,execute:function(e){o.$rootScope.$apply(function(){t&&t(e)})}};o.callbackMaps.push(i),s.connection.on(e,i.execute)},off:function(e,t){var i=o.callbackMaps.filter(function(e){return e.callback==t}).shift();o.callbackMaps.splice(o.callbackMaps.indexOf(i),1),s.connection.off(e,i.execute)},invoke:function(e,t){s.connection.invoke(e).done(function(e){o.$rootScope.$apply(function(){t&&t(e)})})}})},i.$inject=["$rootScope","$q","assetsService"],t=i,e.FrontendHub=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(){}t=e.Services||(e.Services={}),o.prototype.setMergeFieldsForRichTextEditor=function(e){var t=window.NewsletterStudio||{};t.RichTextEditor=t.RichTextEditor||{},t.RichTextEditor.State=t.RichTextEditor.state||{},t.RichTextEditor.State.mergeFields=e},o.$inject=[],i=o,t.MergeFieldService=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i){this.$http=e,this.notificationsService=t,this.localizationService=i}t=e.Services||(e.Services={}),o.prototype.getStoredValue=function(e){var t=e.model.value;return e.setting&&e.setting.value&&(t=JSON.parse(e.setting.value)),t},o.prototype.setStoredValue=function(e,t){e.model&&(e.model.value=t),e.setting&&(e.setting.value=JSON.stringify(t))},o.prototype.getConfigurationOrDefault=function(e){if(e.model&&e.model.config){var t={min:0,max:0};return e.model.config.min&&(t.min=parseInt(e.model.config.min)),e.model.config.max&&(t.max=parseInt(e.model.config.max)),t}return{min:0,max:0}},o.$inject=[],i=o,t.DataEditorHelper=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){this.notificationsService=e,this.nsLocation=t}t=e.Controllers||(e.Controllers={}),o.$inject=["notificationsService","nsLocation"],i=o,t.DashboardController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e){this.nsLocation=e}t=e.Controllers||(e.Controllers={}),o.$inject=["nsLocation"],i=o,t.PackageSettingsController=i}(NewsletterStudio=NewsletterStudio||{}),function(t){var e,i;function o(e,t,i,o,s,r){var n=this;this.$scope=e,this.campaignService=t,this.nsLocation=i,this.nsEditorService=o,this.nsFrontendHub=s,this.$timeout=r,this.updateProgress=function(e){if("CampaignProgress"===e.type){var t=e.meta.email;if(n.workspaceKey!=t.workspaceKey)return;100==t.processedPercent&&n.$timeout(function(){n.updateList()},1e3)}},this.nextPage=function(e){n.filter.page=e,n.updateList()},this.prevPage=function(e){n.filter.page=e,n.updateList()},this.goToPage=function(e){n.filter.page=e,n.updateList()},this.init(),this.nsFrontendHub.initHub(function(e){e.on("Message",n.updateProgress),e.start(),n.hub=e}),e.$on("$destroy",function(){n.hub.off("Message",n.updateProgress)})}e=t.Controllers||(t.Controllers={}),o.prototype.init=function(){var t=this;this.workspaceKey=this.nsLocation.workspaceKey(),this.filter={workspaceKey:this.workspaceKey,filterState:"all",page:1,search:""},this.campaignService.getOverviewForWorkspace(this.workspaceKey,function(e){t.data=e.data,t.nsLocation.setTreePath(e.data)})},o.prototype.setFilter=function(e){this.filter={workspaceKey:this.workspaceKey,filterState:e,page:1,search:""},this.updateList()},o.prototype.setSearch=function(){this.filter.page=1,this.updateList()},o.prototype.updateList=function(){var t=this;this.campaignService.getPagedCampaignListItems(this.filter,function(e){t.data.campaigns=e.data})},o.prototype.getPreviewUrl=function(e){return t.UmbracoFacade.getPreviewCampaignUrl(e.key)},o.prototype.openDraft=function(e){if("sending"==e.state)this.nsLocation.goToUrl("/umbraco/#/newsletterStudio");else if(1==e.umbracoContent)this.nsLocation.goToUrl("/umbraco/#/content/content/edit/"+e.umbracoContentKey);else{var t=this.nsLocation.getViewPath("campaign",e.key);this.nsLocation.goToUrl(t)}},o.prototype.openAnalytics=function(e){var t=this.nsLocation.getViewPath("campaign-report",e.key);this.nsLocation.goToUrl(t)},o.prototype.delete=function(t){var i=this;t.showActionMenu=!1,this.nsEditorService.confirmation({titleLocalizationKey:"ns_confirmation_genericRemoveHeader",descriptionLocalizationKey:"ns_campaigns_confirmRemove_details",tokenValues:[t.name],confirm:function(){i.campaignService.delete(i.workspaceKey,t.id,function(){var e=i.data.campaigns.items.indexOf(t);i.data.campaigns.items.splice(e,1)})}})},o.prototype.duplicate=function(e){var t=this;e.showActionMenu=!1,this.campaignService.duplicate(this.workspaceKey,e.id,function(){t.filter.page=1,t.updateList()})},o.$inject=["$scope","nsCampaignService","nsLocation","nsEditorService","nsFrontendHub","$timeout"],i=o,e.CampaignsController=i}(NewsletterStudio=NewsletterStudio||{}),function(c){var e,t;function i(e,t,i,o,s,r,n){var a=this;this.notificationsService=e,this.nsCampaignService=t,this.nsLocation=i,this.nsFormHelper=o,this.$scope=s,this.nsMergeFieldService=r,this.nsServiceHelper=n,this.currentStep=1,this.formInformation=void 0,this.formSend=void 0,this.validationErrors=[],this.selectedLists=[],this.dateTimeProperty={view:"datepicker",value:""},this.previewWidth=900,this.triedToSend=!1,this.btnSendTestState=umbraco.directives.umbButton.states.init,this.btnSave={state:umbraco.directives.umbButton.states.init},this.btnSaveAndClose={state:umbraco.directives.umbButton.states.init},this.step3Loading=!0,t.getByKey(i.entityKey(),i.workspaceKey(),function(e){a.data=e.data,a.dateTimeProperty.value=a.data.campaign.scheduledSendDate,c.Utilities.isNullOrEmpty(a.dateTimeProperty.value)||(a.sendType="schedule"),a.setCurrentTheme(),r.setMergeFieldsForRichTextEditor(e.data.mergeFields),a.nsLocation.setTreePath(e.data)})}e=c.Controllers||(c.Controllers={}),i.prototype.getPreviewUrl=function(){return c.UmbracoFacade.getPreviewCampaignUrl(this.data.campaign.uniqueKey)},i.prototype.setCurrentTheme=function(){var i=this;angular.forEach(this.data.themes,function(e,t){e.alias===i.data.campaign.themeAlias&&(i.selectedTheme=e)})},i.prototype.toStep1=function(){this.currentStep=1},i.prototype.toStep2=function(){2<this.currentStep?this.currentStep=2:this.nsFormHelper.validate(this.formInformation)&&(this.currentStep=2)},i.prototype.toStep3=function(){var e=this;this.step3Loading=!0,this.currentStep=3,this.saveToServer(function(){e.step3Loading=!1},!1,function(){e.currentStep=1})},i.prototype.toStep4=function(){this.currentStep=4},i.prototype.close=function(){window.history.back()},i.prototype.saveAndClose=function(){this.saveToServer(function(){window.history.back()},!0,!1,this.btnSaveAndClose)},i.prototype.save=function(){this.saveToServer(!1,!0,!1,this.btnSave)},i.prototype.saveToServer=function(t,i,o,e){var s=this;this.data.campaign.scheduledSendDate=this.dateTimeProperty.value,this.nsCampaignService.saveWithState(this.data.campaign,e,function(e){s.resetValidationErrors(),s.data.campaign.id=e.data.id,s.data.campaign.uniqueKey=e.data.uniqueKey,s.nsFormHelper.resetErrors(s.formInformation),s.nsFormHelper.resetErrors(s.formSend),t&&t(),void 0!==t&&!0!==i||s.notificationsService.success("Success","Campaign was saved")},function(e){s.handleValidationErrors(e),o&&o(e)})},i.prototype.sendTestEmail=function(){var t=this;if(c.Utilities.String.isValidEmail(this.previewSendTestToEmail)){var e={email:this.previewSendTestToEmail,campaignModel:this.data.campaign};this.btnSendTestState=umbraco.directives.umbButton.states.busy,this.nsCampaignService.sendTestEmail(e,function(){t.notificationsService.success("Test email sent","Email was sent"),t.btnSendTestState=umbraco.directives.umbButton.states.success},function(e){t.btnSendTestState=umbraco.directives.umbButton.states.error,t.nsServiceHelper.showErrorNotification(e)})}else this.notificationsService.error("Sending error","Invalid test-recipient, please check the e-mail.")},i.prototype.saveAndSendOrSchedule=function(){var t=this;this.data.campaign.scheduledSendDate=this.dateTimeProperty.value;var e={campaign:this.data.campaign,sendNow:"now"===this.sendType};this.nsCampaignService.saveAndSendOrSchedule(e,function(e){t.formInformation.$setPristine(),t.formSend.$setPristine(),e.data.sending?(t.close(),t.notificationsService.success("Sending","Campaign is sending")):e.data.scheduled&&t.notificationsService.success("Scheduled","Campaign was scheduled")},function(e){t.handleValidationErrors(e),t.triedToSend=!0})},i.prototype.cancelScheduledSendOut=function(){this.sendType="",this.data.campaign.scheduledSendDate="",this.dateTimeProperty.value=""},i.prototype.handleValidationErrors=function(e){var t;(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.validationErrors)&&(this.validationErrors=e.data.validationErrors,this.nsFormHelper.setErrors(this.formInformation,e),this.nsFormHelper.setErrors(this.formSend,e),this.notificationsService.error("Not saved","Campaign not saved due to validation errors."))},i.prototype.resetValidationErrors=function(){this.validationErrors=[]},i.$inject=["notificationsService","nsCampaignService","nsLocation","nsFormHelper","$scope","nsMergeFieldService","nsServiceHelper"],t=i,e.CampaignController=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i,o){this.nsCampaignReportService=e,this.notificationService=t,this.nsLocation=i,this.$location=o,this.campaignKey=this.nsLocation.entityKey(),this.workspaceKey=this.nsLocation.workspaceKey()}t=e.Controllers||(e.Controllers={}),o.$inject=["nsCampaignReportService","notificationsService","nsLocation","$location"],i=o,t.CampaignReportController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(){}t=e.Controllers||(e.Controllers={}),o.$inject=[],i=o,t.ContactsOverviewController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(){}t=e.Controllers||(e.Controllers={}),o.$inject=[],i=o,t.WorkspaceOverviewController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){var i=this;this.nsLocation=e,this.transactionalService=t,this.workspaceKey=e.workspaceKey(),this.transactionalService.getTransactionalOverview(this.workspaceKey,function(e){i.nsLocation.setTreePath(e.data),i.log=e.data.log})}t=e.Controllers||(e.Controllers={}),o.$inject=["nsLocation","nsTransactionalService"],i=o,t.TransactionalOverviewController=i}(NewsletterStudio=NewsletterStudio||{}),function(i){var e,t;function o(e,t,i,o,s,r,n,a){this.nsLocation=e,this.nsFormHelper=t,this.transactionalService=i,this.nsMergeFieldService=o,this.notificationsService=s,this.$scope=r,this.nsEditorService=n,this.nsServiceHelper=a,this.activeTab="email",this.btnSave={state:umbraco.directives.umbButton.states.init},this.btnSendTestEmail={state:umbraco.directives.umbButton.states.init},this.showActionMenu=!1,this.validationErrors=[],this.formInformation=void 0,this.formSettings=void 0,this.showEditor=!1,this.currentStep=1,this.previewWidth=900,this.init()}e=i.Controllers||(i.Controllers={}),o.prototype.init=function(){var t=this;this.transactionalService.getDetails(this.nsLocation.workspaceKey(),this.nsLocation.entityKey(),function(e){t.data=e.data,t.nsLocation.setTreePath(e.data),t.setCurrentTheme(),t.loadMergeFieldsForCurrentSelection(),t.data.log&&0!=t.data.log.sentTotal||(t.activeTab="settings")})},o.prototype.loadMergeFieldsForCurrentSelection=function(){var t=this;i.Utilities.isNullOrEmpty(this.data.details.typedModelAlias)?this.nsMergeFieldService.setMergeFieldsForRichTextEditor([]):this.transactionalService.getFieldsByAlias(this.data.details.typedModelAlias,function(e){t.nsMergeFieldService.setMergeFieldsForRichTextEditor(e.data)})},o.prototype.openDesigner=function(){this.showEditor=!0},o.prototype.closeEditor=function(){this.showEditor=!1},o.prototype.toStep1=function(){this.currentStep=1},o.prototype.toStep2=function(){2<this.currentStep?this.currentStep=2:this.nsFormHelper.validate(this.formInformation)&&(this.currentStep=2)},o.prototype.toStep3=function(){this.currentStep=3},o.prototype.setCurrentTheme=function(){var i=this;angular.forEach(this.data.themes,function(e,t){e.alias===i.data.details.themeAlias&&(i.selectedTheme=e)})},o.prototype.getPreviewUrl=function(){return i.UmbracoFacade.getPreviewTransactionalUrl(this.data.details.key)},o.prototype.sendTestEmail=function(){var e=this;if(i.Utilities.String.isValidEmail(this.previewSendTestToEmail)){var t={email:this.previewSendTestToEmail,transactional:this.data.details};this.transactionalService.sendTestEmail(t,this.btnSendTestEmail,function(){e.notificationsService.success("Test email sent","Email was sent")})}else this.notificationsService.error("Sending error","Invalid test-recipient, please check the e-mail.")},o.prototype.createNew=function(e){var t=this;if(this.nsFormHelper.validate(e)){var i={key:"-1",name:this.newName,workspaceKey:this.nsLocation.workspaceKey()};this.transactionalService.save(i,null,function(e){t.nsLocation.setEntityKey(e.data)})}},o.prototype.save=function(){this.formSettings&&!this.nsFormHelper.validate(this.formSettings)||this.saveToServer(!1,!0,!1,this.btnSave)},o.prototype.saveAndCloseEditor=function(){this.saveToServer(!1,!0,!1,this.btnSave),this.showEditor=!1},o.prototype.saveToServer=function(t,i,o,e){var s=this,r=this.data.details;this.transactionalService.save(r,this.btnSave,function(e){s.nsLocation.setTreePath(s.data),s.resetValidationErrors(),s.nsFormHelper.resetErrors(s.formInformation),t&&t(),void 0!==t&&!0!==i||s.notificationsService.success("Success","Email was saved")},function(e){s.handleValidationErrors(e),o&&o(e)})},o.prototype.setActiveTab=function(e){this.activeTab=e},o.prototype.handleValidationErrors=function(e){var t;(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.validationErrors)&&(this.validationErrors=e.data.validationErrors,this.nsFormHelper.setErrors(this.formInformation,e),this.notificationsService.error("Not saved","Could not save due to validation errors."))},o.prototype.resetValidationErrors=function(){this.validationErrors=[]},o.prototype.removeEmail=function(){var e=this;this.showActionMenu=!1,this.nsEditorService.confirmation({titleLocalizationKey:"ns_confirmation_genericRemoveHeader",descriptionLocalizationKey:"ns_transactional_confirmRemove_details",tokenValues:[this.data.details.name],confirm:function(){e.transactionalService.delete(e.nsLocation.workspaceKey(),e.data.details.id,function(){window.history.back(-1)})}})},o.$inject=["nsLocation","nsFormHelper","nsTransactionalService","nsMergeFieldService","notificationsService","$scope","nsEditorService","nsServiceHelper"],t=o,e.TransactionalController=t}(NewsletterStudio=NewsletterStudio||{}),function(t){var e,i;function o(e,t,i){var o=this;this.nsLocation=e,this.transactionalService=t,this.nsEditorService=i,this.nextPage=function(e){o.filter.page=e,o.updateList()},this.prevPage=function(e){o.filter.page=e,o.updateList()},this.goToPage=function(e){o.filter.page=e,o.updateList()},this.workspaceKey=e.workspaceKey(),this.filter={workspaceKey:this.workspaceKey,filterState:"all",page:1,search:""},this.transactionalService.getTransactionalEmailsOverview(this.workspaceKey,function(e){o.data=e.data,o.nsLocation.setTreePath(e.data)})}e=t.Controllers||(t.Controllers={}),o.prototype.getPreviewUrl=function(e){return t.UmbracoFacade.getPreviewTransactionalUrl(e.key)},o.prototype.openEdit=function(e){var t=this.nsLocation.getViewPath("transactional",e.key);this.nsLocation.goToUrl(t)},o.prototype.setFilter=function(e){this.filter={workspaceKey:this.workspaceKey,filterState:e,page:1,search:""},this.updateList()},o.prototype.setSearch=function(){this.filter.page=1,this.updateList()},o.prototype.updateList=function(){var t=this;this.transactionalService.getPagedTransactionalListItems(this.filter,function(e){t.data.emails=e.data})},o.prototype.delete=function(t){var i=this;t.showActionMenu=!1,this.nsEditorService.confirmation({titleLocalizationKey:"ns_confirmation_genericRemoveHeader",descriptionLocalizationKey:"ns_transactional_confirmRemove_details",tokenValues:[t.name],confirm:function(){i.transactionalService.delete(i.workspaceKey,t.id,function(){var e=i.data.emails.items.indexOf(t);i.data.emails.items.splice(e,1)})}})},o.prototype.duplicate=function(e){var t=this;e.showActionMenu=!1,this.transactionalService.duplicate(this.workspaceKey,e.id,function(){t.updateList()})},o.$inject=["nsLocation","nsTransactionalService","nsEditorService"],i=o,e.TransactionalEmailsController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i){this.mailingListService=e,this.notificationService=t,this.nsLocation=i,this.execute()}t=e.Controllers||(e.Controllers={}),o.prototype.execute=function(){var t=this;this.mailingListService.getOverviewForWorkspace(this.nsLocation.workspaceKey(),function(e){t.data=e.data,t.nsLocation.setTreePath(e.data)})},o.$inject=["nsMailingListService","notificationsService","nsLocation"],i=o,t.MailingListsOverviewController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i,o,s,r,n,a,c,l,p,d){var u=this;this.mailingListService=e,this.notificationService=t,this.nsLocation=i,this.editorService=o,this.$scope=s,this.$timeout=r,this.nsFormHelper=n,this.$location=a,this.$route=c,this.$routeParams=l,this.nsEditorService=p,this.localizationService=d,(this.self=this).searchFilter="",this.filterStatus="subscribed",this.statusFilterOptions=[],this.showActionMenu=!1,this.nextPage=function(e){u.updateSubscribers(e)},this.prevPage=function(e){u.updateSubscribers(e)},this.goToPage=function(e){u.updateSubscribers(e)},this.init()}t=e.Controllers||(e.Controllers={}),o.prototype.init=function(){var t=this;0==this.statusFilterOptions.length&&(this.statusFilterOptions.push({labelKey:"ns_all",value:""}),this.statusFilterOptions.push({labelKey:"ns_subscriptionStatus_Subscribed",value:"subscribed"}),this.statusFilterOptions.push({labelKey:"ns_subscriptionStatus_Unsubscribed",value:"unsubscribed"}),this.statusFilterOptions.push({labelKey:"ns_subscriptionStatus_Pending",value:"pending"})),this.setStatusFilter(this.statusFilterOptions[1],!1),this.searchFilter=this.$routeParams.searchFilter||"";var e=this.$routeParams.page||"1";this.mailingListService.getDetails(this.nsLocation.workspaceKey(),this.nsLocation.entityKey(),this.searchFilter,this.filterStatus,e,function(e){t.data=e.data,t.nsLocation.setTreePath(e.data),t.saveButtonState=umbraco.directives.umbButton.states.init})},o.prototype.openImport=function(){var t=this;this.showActionMenu=!1;var e=this.nsLocation.workspaceKey(),i=this.nsLocation.entityKey();this.nsEditorService.openRecipientsImport(e,i,function(e){t.init()})},o.prototype.actionRemoveList=function(){var e=this;this.nsEditorService.confirmation({titleLocalizationKey:"ns_mailingList_confirmRemove_header",descriptionLocalizationKey:"ns_mailingList_confirmRemove_details",tokenValues:[this.data.name],confirm:function(){e.mailingListService.remove(e.data.key,function(e){window.history.back(-1)})}})},o.prototype.openRecipientDetails=function(e){var t=this;this.nsEditorService.openRecipientDetails(this.nsLocation.workspaceKey(),e.key,function(e){t.updateSubscribers(t.data.subscribers.currentPage)})},o.prototype.setStatusFilter=function(e,t){var i=this;this.filterStatus=e.value,this.localizationService.localize(e.labelKey).then(function(e){i.selectedFilterText=e}),!1!==t&&this.updateSubscribers(1)},o.prototype.updateSubscribers=function(t){var i=this;this.mailingListService.getPagedSubscribers(this.nsLocation.workspaceKey(),this.nsLocation.entityKey(),this.searchFilter,this.filterStatus,t,function(e){i.data.subscribers=e.data,i.nsLocation.pocUpdateSearch({e:i.nsLocation.entityKey(),page:t,searchFilter:i.searchFilter},!1)})},o.prototype.save=function(){var t=this;this.saveButtonState=umbraco.directives.umbButton.states.busy;var e={key:this.data.key,name:this.data.name};this.mailingListService.save(e,function(e){t.saveButtonState=umbraco.directives.umbButton.states.success})},o.prototype.createNew=function(e){var t=this;if(this.nsFormHelper.validate(e)){var i={key:"-1",name:this.newName,workspaceKey:this.nsLocation.workspaceKey()};this.mailingListService.save(i,function(e){t.nsLocation.setEntityKey(e.data)})}},o.$inject=["nsMailingListService","notificationsService","nsLocation","editorService","$scope","$timeout","nsFormHelper","$location","$route","$routeParams","nsEditorService","localizationService"],i=o,t.MailingListDetailsController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t){this.nsLocation=e,this.nsRecipientService=t,this.workspaceKey="",this.recipientKey="",this.workspaceKey=this.nsLocation.workspaceKey(),this.recipientKey=this.nsLocation.entityKey()}t=e.Controllers||(e.Controllers={}),o.$inject=["nsLocation","nsRecipientService"],i=o,t.RecipientDetailsController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i,o){var s=this;this.nsLocation=e,this.nsRecipientService=t,this.nsEditorService=i,this.localizationService=o,this.statusFilterOptions=[],this.filterStatus="active",this.searchFilter="",this.nextPage=function(e){s.updateRecipients(e)},this.prevPage=function(e){s.updateRecipients(e)},this.goToPage=function(e){s.updateRecipients(e)},this.statusFilterOptions.push({labelKey:"ns_all",value:""}),this.statusFilterOptions.push({labelKey:"ns_active",value:"active"}),this.statusFilterOptions.push({labelKey:"ns_globallyUnsubscribed",value:"globallyUnsubscribed"}),this.setStatusFilter(this.statusFilterOptions[1],!1),this.nsRecipientService.getOverviewForWorkspace(this.nsLocation.workspaceKey(),function(e){s.data=e.data,s.nsLocation.setTreePath(e.data)})}t=e.Controllers||(e.Controllers={}),o.prototype.execute=function(){},o.prototype.updateRecipients=function(e){var t=this;this.nsRecipientService.getPagedRecipients(this.nsLocation.workspaceKey(),this.searchFilter,this.filterStatus,e,function(e){t.data.recipients=e.data.recipients})},o.prototype.setStatusFilter=function(e,t){var i=this;this.filterStatus=e.value,this.localizationService.localize(e.labelKey).then(function(e){i.selectedFilterText=e}),!1!==t&&this.updateRecipients(1)},o.prototype.openDetails=function(e){var t=this;this.nsEditorService.openRecipientDetails(this.nsLocation.workspaceKey(),e.key,function(e){t.updateRecipients(t.data.recipients.currentPage)})},o.$inject=["nsLocation","nsRecipientService","nsEditorService","localizationService"],i=o,t.RecipientsOverviewController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i,o){var s=this;this.nsLocation=e,this.nsWorkspaceService=t,this.nsFormHelper=i,this.nsUiHelper=o,this.btnSaveState=umbraco.directives.umbButton.states.init,this.pocDoubleOptInModel=[],this.workspaceKey=this.nsLocation.workspaceKey(),this.pocDoubleOptInModel.push({workspaceKey:"10b95d1c-a89c-4fdd-b7ff-b5533edfe90a",transactionalEmailKey:"2033af35-bab9-409f-b7cf-e69f43d24c84"}),this.nsWorkspaceService.getSettings(this.workspaceKey,function(e){s.settings=e.data,s.nsLocation.setTreePath(e.data)})}t=e.Controllers||(e.Controllers={}),o.prototype.save=function(t){var i=this;this.nsFormHelper.validate(t)&&(this.btnSaveState=umbraco.directives.umbButton.states.busy,this.nsWorkspaceService.saveSettings(this.settings,function(e){i.btnSaveState=umbraco.directives.umbButton.states.success,i.nsFormHelper.resetErrors(t)},function(e){i.btnSaveState=umbraco.directives.umbButton.states.error,i.nsFormHelper.setErrors(t,e),i.nsUiHelper.notificationError("ns_validationNotificationHeader","ns_validationNotificationMessage")}))},o.$inject=["nsLocation","nsWorkspaceService","nsFormHelper","nsUiHelper"],i=o,t.WorkspaceSettingsController=i}(NewsletterStudio=NewsletterStudio||{}),function(o){var e,t;function i(e,t,i,o,s){this.nsLocation=e,this.$location=t,this.nsWorkspaceService=i,this.nsFormHelper=o,this.notificationsService=s,this.view="overview",this.newName="",this.newCreateEmptyInstance=!1,this.connectLicenseView="login",this.email="",this.password="",this.licenseMapButtonLoginStatus="init",this.licenseMapButtonPerformMapStatus="init","true"===t.search().add&&(this.view="create"),this.nsLocation.setTreePath({path:["-1","administration"]}),this.loadOverview()}e=o.Controllers||(o.Controllers={}),i.prototype.loadOverview=function(){var t=this;this.nsWorkspaceService.getOverview(function(e){t.workspaces=e.data.workspaces,t.licenseDetails=e.data.licenseDetails})},i.prototype.showAdd=function(){this.$location.search("add","true")},i.prototype.createNew=function(e){var t=this;if(this.nsFormHelper.validate(e)){var i={name:this.newName,createEmptyInstance:this.newCreateEmptyInstance};this.nsWorkspaceService.createNew(i,function(e){t.nsLocation.refreshRootTree(),t.nsLocation.setTreePath({path:["-1"]}),t.nsLocation.goToView("administration-manage","",e.data.key)})}},i.prototype.login=function(){var t=this;this.licenseMapButtonLoginStatus="busy",this.nsWorkspaceService.licensesGet({email:this.email,password:this.password},function(e){e.data.licenseDetails?t.loadOverview():(e.data.licenses.forEach(function(e){e.btnStatus="init"}),t.licenseList=e.data.licenses),t.licenseMapButtonLoginStatus="success",t.connectLicenseView="choose"},function(e){t.licenseMapButtonLoginStatus="error",t.notificationsService.error("Error",e.data.message)})},i.prototype.selectLicense=function(t){var i=this;if(1==(this.selectedLicense=t).workspaces.length&&1==this.workspaces.length){var e={licenseKey:t.id,connections:[{workspaceNumber:1,workspaceKey:this.workspaces[0].key}]};t.btnStatus="busy",this.nsWorkspaceService.licenseConnect(e,function(e){t.btnStatus="success",i.loadOverview()})}else this.updateUnmappedWorkspaces(),this.connectLicenseView="map"},i.prototype.licenseMapped=function(){this.updateUnmappedWorkspaces()},i.prototype.updateUnmappedWorkspaces=function(){var o=this;this.selectedLicense.workspaces.forEach(function(e){var i=[];o.workspaces.forEach(function(t){e.key===t.key?i.push(t):o.selectedLicense.workspaces.filter(function(e){return e.key===t.key}).shift()||i.push(t),e.dropDownWorkspaces=i})})},i.prototype.performMapping=function(){var t=this;this.licenseMapButtonPerformMapStatus="busy";var i={licenseKey:this.selectedLicense.id,connections:[]};this.selectedLicense.workspaces.forEach(function(e){!0!==e.isLocked&&!1===o.Utilities.isNullOrEmpty(e.key)&&i.connections.push({workspaceNumber:e.workspaceNumber,workspaceKey:e.key})}),this.nsWorkspaceService.licenseConnect(i,function(e){t.licenseMapButtonPerformMapStatus="success",t.loadOverview()})},i.$inject=["nsLocation","$location","nsWorkspaceService","nsFormHelper","notificationsService"],t=i,e.AdministrationController=t}(NewsletterStudio=NewsletterStudio||{}),function(s){var e,t;function i(e,t,i,o,s,r,n,a,c,l,p){var d=this;this.nsLocation=e,this.nsWorkspaceService=t,this.editorService=i,this.localizationService=o,this.notificationsService=s,this.uiHelper=r,this.nsFormHelper=n,this.nsEditorService=a,this.nsUiHelper=c,this.$scope=l,this.usersResource=p,this.showLicenseDetails=!1,this.btnSaveState=umbraco.directives.umbButton.states.init,this.regExCustomFieldAlias="^[a-zA-Z0-9_-]*$",this.nsLocation.setTreePath({path:["-1","administration"]}),this.nsWorkspaceService.getManage(this.nsLocation.workspaceKey(),function(e){d.model=e.data.model,d.permissionTypes=e.data.accessPermissionsTypes,d.recipientListProviders=e.data.recipientListProviders,d.campaignMergeFieldProviders=e.data.campaignMergeFieldProviders,d.transactionalMergeFieldProviders=e.data.transactionalMergeFieldProviders,d.emailControls=e.data.emailControls,d.themes=e.data.themes,d.emailServiceProviders=e.data.emailServiceProviders,d.workspaceOriginalName=e.data.model.name,d.model.emailServiceProvider.alias||(d.model.emailServiceProvider.alias=d.emailServiceProviders[0].alias),d.emailServiceProviderChanged()})}e=s.Controllers||(s.Controllers={}),i.prototype.save=function(t){var o=this;this.nsFormHelper.validate(t)&&(this.btnSaveState=umbraco.directives.umbButton.states.busy,this.nsWorkspaceService.saveManage(this.model,function(e){o.btnSaveState=umbraco.directives.umbButton.states.success,o.workspaceOriginalName!==o.model.name&&(o.nsLocation.refreshWorkspaceNode(o.model.key),o.workspaceOriginalName=o.model.name);var i=[];s.Utilities.forEach(o.model.access,function(e,t){e.open&&i.push(t)}),o.model=e.data.value.model,s.Utilities.forEach(o.model.access,function(e,t){-1<i.indexOf(t)&&(e.open=!0)})},function(e){o.btnSaveState=umbraco.directives.umbButton.states.error,o.nsFormHelper.setErrors(t,e),o.nsUiHelper.notificationError("ns_validationNotificationHeader","ns_validationNotificationMessage"),o.$scope.$broadcast("validationErrors",e)}))},i.prototype.cancel=function(){this.nsLocation.goToView("administration","","")},i.prototype.addPermissionsUserGroup=function(){var i=this;this.editorService.userGroupPicker({submit:function(e){e.selection&&0<e.selection.length&&e.selection.forEach(function(t){"admin"===t.alias?i.uiHelper.notificationError("ns_invalid","ns_workspace_administratorsHasAllAccess"):0<i.model.access.filter(function(e){return e.userGroupId===t.id}).length?i.uiHelper.notificationError("ns_invalid","ns_workspace_permissionsAlreadyConfigured",[t.name]):i.model.access.push({id:0,userGroupId:t.id,name:t.name,permissions:i.permissionTypes.map(function(e){return e.alias}),open:!0})}),i.editorService.close()},close:function(){i.editorService.close()}})},i.prototype.addPermissionsUser=function(){var i=this;this.editorService.userPicker({multiPicker:!1,submit:function(e){e.selection&&0<e.selection.length&&e.selection.forEach(function(e){i.usersResource.getUser(e.id).then(function(t){var e=0<t.userGroups.filter(function(e){return"admin"===e.alias}).length;-1===t.id||e?i.uiHelper.notificationError("ns_invalid","ns_workspace_userIsAnAdminWithAllAccess",[t.name]):0<i.model.access.filter(function(e){return e.userId===t.id}).length?i.uiHelper.notificationError("ns_invalid","ns_workspace_permissionsAlreadyConfigured",[t.name]):i.model.access.push({id:0,userId:t.id,name:t.name,permissions:i.permissionTypes.map(function(e){return e.alias}),open:!0})})}),i.editorService.close()},close:function(){i.editorService.close()}})},i.prototype.getLocalizationKeysFromPermissionAliases=function(t){return this.permissionTypes.filter(function(e){return-1<t.indexOf(e.alias)}).map(function(e){return e.localizationKey})},i.prototype.accessRemove=function(e){var t=this.model.access.indexOf(e);this.model.access.splice(t,1),0<e.id&&this.model.accessIdsRemoved.push(e.id)},i.prototype.customFieldRemove=function(t){function e(){var e=i.model.customFields.indexOf(t);i.model.customFields.splice(e,1)}var i=this;""===t.mergeFieldAlias&&""===t.fieldLabel?e():this.nsEditorService.confirmation({titleLocalizationKey:"ns_workspace_customFieldRemoveConfirmHeader",descriptionLocalizationKey:"ns_workspace_customFieldRemoveConfirmDescription",submitButtonLabelKey:"ns_workspace_customFieldRemoveConfirmButton",confirm:function(){e()}})},i.prototype.customFieldAdd=function(){var e=this.getNextFreeFieldAlias();this.model.customFields.push({customFieldAlias:e,fieldLabel:"",mergeFieldAlias:""})},i.prototype.getNextFreeFieldAlias=function(){var e=this.model.customFields.map(function(e){return e.customFieldAlias});if(0==e.length)return"customField1";for(var t=1;t<=10;t++){var i="customField"+t;if(-1===e.indexOf(i))return i}throw"No free fields"},i.prototype.getSelectableDefaultThemes=function(){var t=this;return this.themes.filter(function(e){return-1<t.model.themes.indexOf(e.id)})},i.prototype.getSelectableTransactionalDefaultThemes=function(){var t=this;return this.themes.filter(function(e){return-1<t.model.transactionalThemes.indexOf(e.id)})},i.prototype.emailServiceProviderChanged=function(){var t=this,e=this.emailServiceProviders.filter(function(e){return e.alias===t.model.emailServiceProvider.alias}).shift();this.selectedEmailServiceProvider=e},i.prototype.removeWorkspace=function(){var e=this;this.nsEditorService.confirmation({titleLocalizationKey:"ns_workspace_removeWorkspaceConfirmationHeader",descriptionLocalizationKey:"ns_workspace_removeWorkspaceConfirmationDescription",submitButtonLabelKey:"ns_workspace_removeWorkspaceConfirmationBtn",tokenValues:[this.model.name],confirm:function(){e.nsWorkspaceService.remove(e.model.key,function(){e.notificationsService.success("Workspace Removed","Successfully removed Workspace"),e.nsLocation.refreshRootTree(),e.nsLocation.setTreePath({path:["-1"]}),e.nsLocation.goToView("administration","","")})}})},i.$inject=["nsLocation","nsWorkspaceService","editorService","localizationService","notificationsService","nsUiHelper","nsFormHelper","nsEditorService","nsUiHelper","$scope","usersResource"],t=i,e.AdministrationManageController=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i,o,s){this.nsLocation=e,this.$location=t,this.nsWorkspaceService=i,this.nsFormHelper=o,this.notificationsService=s,this.nsLocation.setTreePath({path:["-1","administration"]}),this.loadOverview()}t=e.Controllers||(e.Controllers={}),o.prototype.loadOverview=function(){},o.$inject=["nsLocation","$location","nsWorkspaceService","nsFormHelper","notificationsService"],i=o,t.AdministrationAboutController=i}(NewsletterStudio=NewsletterStudio||{}),function(o){var e,t,i;function s(e,t,i,o,s,r,n){this.$scope=e,this.notificationService=t,this.nsLocation=i,this.editorService=o,this.$timeout=s,this.$http=r,this.nsServiceHelper=n,this.test="hallo from controller",this.mappingError=!1,this.execute()}e=o.Controllers||(o.Controllers={}),t=e.Dialogs||(e.Dialogs={}),s.prototype.execute=function(){var i=this;this.workspaceKey=this.$scope.model.data.workspaceKey,this.mailingListKey=this.$scope.model.data.mailingListKey,this.step="step1",this.pasteButtonState=umbraco.directives.umbButton.states.init,this.importButtonState=umbraco.directives.umbButton.states.init,this.$scope.$on("fileSelected",function(e,t){i.$scope.$apply(function(){i.selectedFile=t.file,i.uploadFile()})})},s.prototype.showStep=function(e){this.step=e},s.prototype.didPaste=function(e){var t=this,i=e.originalEvent.clipboardData.getData("text/plain").replace(new RegExp("\t","g"),";");this.$timeout(function(){t.rawText=i},50)},s.prototype.uploadFile=function(){var t=this,e=[this.selectedFile],i={workspaceKey:this.workspaceKey,mailingListKey:this.mailingListKey};this.step="importing",this.nsServiceHelper.upload("/ImportRecipients/UploadFileAndParseForMapping",i,e,function(e){t.step="mappings",t.fileFieldMappings=e.data})},s.prototype.sendPastedToServer=function(e){var t=this;this.pasteButtonState=umbraco.directives.umbButton.states.busy;var i={workspaceKey:this.workspaceKey,mailingListKey:this.mailingListKey,rawText:this.rawText};this.nsServiceHelper.post("/ImportRecipients/UploadPastedAndParseForMapping",i,function(e){t.step="mappings",t.fileFieldMappings=e.data})},s.prototype.performImport=function(){var t=this,i=!1;if(o.Utilities.forEach(this.fileFieldMappings.fileColumnHeaders,function(e){"email"===e.selectedRecipientMergeField&&(i=!0)}),i){var e={workspaceKey:this.workspaceKey,mailingListKey:this.mailingListKey,tempFile:this.fileFieldMappings.tempFile,fieldMappings:this.fileFieldMappings.fileColumnHeaders};this.step="importing",this.nsServiceHelper.post("/ImportRecipients/PerformFileImport",e,function(e){t.step="done",t.importResult=e.data})}else this.mappingError=!0},s.prototype.importFixedIssue=function(t){t.mailingListKey=this.mailingListKey,t.workspaceKey=this.workspaceKey,this.nsServiceHelper.post("/ImportRecipients/ImportFixedIssue",t,function(e){t.done=!0})},s.prototype.reValidate=function(e){o.Utilities.String.isValidEmail(e.email)?e.valid=!0:e.valid=!1},s.prototype.close=function(){this.$scope.model.close()},s.prototype.submit=function(){this.$scope.model.submit({})},s.$inject=["$scope","notificationsService","nsLocation","editorService","$timeout","$http","nsServiceHelper"],i=s,t.ImportRecipientsController=i}(NewsletterStudio=NewsletterStudio||{}),function(i){var e,t,o;function s(e,t,i,o,s){this.$scope=e,this.nsLocation=t,this.editorService=i,this.nsCampaignReportService=o,this.nsEditorService=s,this.supportEditServiceForUmbracoMember=!1,this.isNewsletterStudioRecipient=!1,this.isUmbracoMemberRecipient=!1,this.editButtonType="",this.execute()}e=i.Controllers||(i.Controllers={}),t=e.Dialogs||(e.Dialogs={}),s.prototype.execute=function(){var t=this;this.workspaceKey=this.$scope.model.data.workspaceKey,this.campaignKey=this.$scope.model.data.campaignKey,this.providerRecipientId=this.$scope.model.data.providerRecipientId,this.supportEditServiceForUmbracoMember=void 0!==this.editorService.memberEditor,this.isNewsletterStudioRecipient=i.Utilities.RecipientListProviders.isNewsletterStudioProviderKey(this.providerRecipientId),this.isUmbracoMemberRecipient=i.Utilities.RecipientListProviders.isUmbracoMemberProviderKey(this.providerRecipientId),this.nsCampaignReportService.getRecipientTimeline(this.campaignKey,this.providerRecipientId,function(e){t.data=e.data,t.editButtonType=t.getEditButtonType()})},s.prototype.openNsDetails=function(){var e=this.workspaceKey,t=i.Utilities.RecipientListProviders.convertProviderIdToKey(this.providerRecipientId);this.nsEditorService.openRecipientDetails(e,t)},s.prototype.openUmbMemberDetails=function(){var e=this,t=i.Utilities.RecipientListProviders.convertUmbracoProviderIdToKey(this.providerRecipientId);this.editorService.memberEditor({id:t,close:function(){e.editorService.close()},submit:function(){e.editorService.close()}})},s.prototype.close=function(){this.$scope.model.close()},s.prototype.submit=function(){this.$scope.model.submit({})},s.prototype.goToLink=function(){this.$scope.model.close(),this.nsLocation.goToUrl(this.data.editRecipientUrl)},s.prototype.getEditButtonType=function(){return i.Utilities.isNullOrEmpty(this.data.editRecipientUrl)?"":this.isNewsletterStudioRecipient&&this.data.userAccessToNewsletterStudioSection?"nsEditorService":this.isUmbracoMemberRecipient&&this.data.userAccessToMemberSection&&this.supportEditServiceForUmbracoMember?"umbMemberEditorService":this.isUmbracoMemberRecipient&&this.data.userAccessToMemberSection?"umbMemberLink":!1===this.isUmbracoMemberRecipient&&0==this.isNewsletterStudioRecipient?"link":""},s.$inject=["$scope","nsLocation","editorService","nsCampaignReportService","nsEditorService"],o=s,t.CampaignReportRecipientController=o}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i,o;function s(e,t,i,o,s,r,n){this.$scope=e,this.notificationService=t,this.nsLocation=i,this.editorService=o,this.$timeout=s,this.$http=r,this.nsServiceHelper=n,this.execute()}t=e.Controllers||(e.Controllers={}),i=t.Dialogs||(t.Dialogs={}),s.prototype.execute=function(){this.workspaceKey=this.$scope.model.data.workspaceKey,this.recipientKey=this.$scope.model.data.recipientKey},s.prototype.save=function(e){this.$scope.model.submit(e)},s.prototype.close=function(){this.$scope.model.close()},s.$inject=["$scope","notificationsService","nsLocation","editorService","$timeout","$http","nsServiceHelper"],o=s,i.RecipientsDetailsController=o}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i,o;function s(e,t,i,o,s,r,n,a,c){this.$scope=e,this.nsTransactionalService=t,this.notificationService=i,this.nsLocation=o,this.editorService=s,this.$timeout=r,this.$http=n,this.nsServiceHelper=a,this.nsEditorService=c,this.init()}t=e.Controllers||(e.Controllers={}),i=t.Dialogs||(t.Dialogs={}),s.prototype.init=function(){var t=this;this.trackingTransactionalId=parseInt(this.$scope.model.data.trackingTransactionalId),this.nsTransactionalService.getTrackingTransactional(this.trackingTransactionalId,function(e){t.data=e.data})},s.prototype.openMessage=function(e){this.nsEditorService.openTransactionalViewMessage(e.trackingTransactionalEmailId)},s.prototype.close=function(){this.$scope.model.close()},s.$inject=["$scope","nsTransactionalService","notificationsService","nsLocation","editorService","$timeout","$http","nsServiceHelper","nsEditorService"],o=s,i.TransactionalTrackingDetailsController=o}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i,o;function s(e,t,i,o,s,r,n,a){this.$scope=e,this.nsTransactionalService=t,this.notificationService=i,this.nsLocation=o,this.editorService=s,this.$timeout=r,this.$http=n,this.nsServiceHelper=a,this.init()}t=e.Controllers||(e.Controllers={}),i=t.Dialogs||(t.Dialogs={}),s.prototype.init=function(){this.trackingTransactionalEmailId=parseInt(this.$scope.model.data.trackingTransactionalEmailId)},s.prototype.getPreviewUrl=function(){return e.UmbracoFacade.getRenderTrackingTransactionalEmailUrl(this.trackingTransactionalEmailId)},s.prototype.close=function(){this.$scope.model.close()},s.$inject=["$scope","nsTransactionalService","notificationsService","nsLocation","editorService","$timeout","$http","nsServiceHelper"],o=s,i.TransactionalViewMessageController=o}(NewsletterStudio=NewsletterStudio||{}),function(i){var e,t;function o(e,t,i,o,s,r,n,a){this.notificationsService=e,this.nsCampaignContentAppService=t,this.editorState=i,this.nsFormHelper=o,this.$scope=s,this.nsEditorService=r,this.campaignService=n,this.nsServiceHelper=a,this.showAnalytics=!1,this.currentStep=1,this.formInformation=void 0,this.formSend=void 0,this.validationErrors=[],this.recipientProviders=[],this.selectedLists=[],this.dateTimeProperty={view:"datepicker",value:""},this.previewWidth=900,this.triedToSend=!1,this.btnSaveState=umbraco.directives.umbButton.states.init,this.btnSaveAndCloseState=umbraco.directives.umbButton.states.init,this.btnSendTestState=umbraco.directives.umbButton.states.init,this.btnCreateState=umbraco.directives.umbButton.states.init,this.btnToStep2State=umbraco.directives.umbButton.states.init,this.contentKey=i.current.key,this.showEditor=!1,this.updateList()}e=i.Controllers||(i.Controllers={}),o.prototype.updateList=function(){var t=this;this.nsCampaignContentAppService.getOverviewFor(this.editorState.current.key,function(e){t.overview=e.data})},o.prototype.onProgressCompleted=function(){this.updateList()},o.prototype.openDraft=function(e){var t=this;"sending"!=e.state&&this.nsCampaignContentAppService.getByKey(e.key,function(e){t.data=e.data,t.dateTimeProperty.value=t.data.campaign.scheduledSendDate,i.Utilities.isNullOrEmpty(t.dateTimeProperty.value)||(t.sendType="schedule"),t.showEditor=!t.showEditor,t.currentStep=1})},o.prototype.openAnalytics=function(e){this.analyticsCampaignKey=e.key,this.analyticsWorkspaceKey=e.workspaceKey,this.showAnalytics=!0},o.prototype.delete=function(t){var i=this;t.showActionMenu=!1,this.nsEditorService.confirmation({titleLocalizationKey:"ns_confirmation_genericRemoveHeader",descriptionLocalizationKey:"ns_campaigns_confirmRemove_details",tokenValues:[t.name],confirm:function(){i.campaignService.delete(t.workspaceKey,t.id,function(){var e=i.overview.drafts.indexOf(t);-1<e&&i.overview.drafts.splice(e,1),-1<(e=i.overview.sent.indexOf(t))&&i.overview.sent.splice(e,1)})}})},o.prototype.duplicate=function(e){var t=this;e.showActionMenu=!1,this.campaignService.duplicate(e.workspaceKey,e.id,function(){t.updateList()})},o.prototype.closeAnalytics=function(){this.showAnalytics=!1},o.prototype.showEmailEditor=function(){var t=this;this.btnCreateState=umbraco.directives.umbButton.states.busy,this.nsCampaignContentAppService.createCampaignFrom(this.editorState.current.key,function(e){t.data=e.data,t.btnCreateState=umbraco.directives.umbButton.states.success,t.showEditor=!0,t.currentStep=1},function(){t.btnCreateState=umbraco.directives.umbButton.states.error})},o.prototype.setWorkspace=function(){var t=this,e=this.data.workspaces.filter(function(e){return e.key==t.data.campaign.workspaceKey}).shift();this.selectedWorkspace=e,this.selectedWorkspace.defaultSenderForce?(this.data.defaultSenderForce=!0,this.data.campaign.senderName=this.selectedWorkspace.senderName,this.data.campaign.senderEmail=this.selectedWorkspace.senderEmail):(this.data.defaultSenderForce=!1,i.Utilities.isNullOrEmpty(this.selectedWorkspace.senderName)||(i.Utilities.isNullOrEmpty(this.data.campaign.senderName)?this.data.campaign.senderName=this.selectedWorkspace.senderName:this.data.workspaces.filter(function(e){return e.senderName===t.data.campaign.senderName}).shift()&&(this.data.campaign.senderName=this.selectedWorkspace.senderName)),i.Utilities.isNullOrEmpty(this.selectedWorkspace.senderName)||(i.Utilities.isNullOrEmpty(this.data.campaign.senderEmail)?this.data.campaign.senderEmail=this.selectedWorkspace.senderEmail:this.data.workspaces.filter(function(e){return e.senderEmail===t.data.campaign.senderEmail}).shift()&&(this.data.campaign.senderEmail=this.selectedWorkspace.senderEmail)))},o.prototype.toStep1=function(){this.currentStep=1},o.prototype.toStep2=function(){var e=this;this.btnToStep2State=umbraco.directives.umbButton.states.busy,this.saveToServer(function(){e.currentStep=2,e.btnToStep2State=umbraco.directives.umbButton.states.success},!1,function(){e.btnToStep2State=umbraco.directives.umbButton.states.error})},o.prototype.toStep3=function(){this.currentStep=3},o.prototype.saveAndClose=function(){var e=this;this.btnSaveAndCloseState=umbraco.directives.umbButton.states.busy,this.saveToServer(function(){e.showEditor=!1,e.btnSaveAndCloseState=umbraco.directives.umbButton.states.success},!0,function(){e.btnSaveAndCloseState=umbraco.directives.umbButton.states.error})},o.prototype.close=function(){this.showEditor=!1,this.btnSaveAndCloseState=umbraco.directives.umbButton.states.init,this.btnSaveState=umbraco.directives.umbButton.states.init},o.prototype.save=function(){var e=this;this.btnSaveState=umbraco.directives.umbButton.states.busy,this.saveToServer(function(){e.btnSaveState=umbraco.directives.umbButton.states.success},!0,function(){e.btnSaveState=umbraco.directives.umbButton.states.error})},o.prototype.saveToServer=function(t,i,o){var s=this;this.nsFormHelper.validate(this.formInformation,!0)?(this.data.campaign.scheduledSendDate=this.dateTimeProperty.value,this.nsCampaignContentAppService.save(this.data.campaign,function(e){s.resetValidationErrors(),s.data.campaign.id=e.data.campaign.id,s.data.campaign.uniqueKey=e.data.campaign.uniqueKey,s.data.sendingValidation=e.data.sendingValidation,s.nsFormHelper.resetErrors(s.formInformation),s.nsFormHelper.resetErrors(s.formSend),t&&t(),void 0!==t&&!0!==i||s.notificationsService.success("Success","Campaign was saved"),s.updateList(),s.btnSaveState=umbraco.directives.umbButton.states.success},function(e){s.setValidationErrors(e),o&&o(e)})):o&&o()},o.prototype.sendTestEmail=function(){var t=this,e={email:this.previewSendTestToEmail,campaignModel:this.data.campaign};this.btnSendTestState=umbraco.directives.umbButton.states.busy,this.nsCampaignContentAppService.sendTestEmail(e,function(){t.notificationsService.success("Test email sent","Email was sent"),t.btnSendTestState=umbraco.directives.umbButton.states.success},function(e){t.btnSendTestState=umbraco.directives.umbButton.states.error,t.nsServiceHelper.showErrorNotification(e)})},o.prototype.saveAndSendOrSchedule=function(){var t=this;this.data.campaign.scheduledSendDate=this.dateTimeProperty.value;var e={campaign:this.data.campaign,sendNow:"now"===this.sendType};this.nsCampaignContentAppService.saveAndSendOrSchedule(e,function(e){t.formInformation.$setPristine(),t.formSend.$setPristine(),e.data.sending?t.notificationsService.success("Sending","Campaign is sending"):e.data.scheduled&&t.notificationsService.success("Scheduled","Campaign was scheduled"),t.showEditor=!1,t.updateList()},function(e){t.triedToSend=!0,t.setValidationErrors(e)})},o.prototype.getPreviewUrl=function(e){return e?i.UmbracoFacade.getPreviewCampaignUrl(e.key):i.UmbracoFacade.getPreviewCampaignUrl(this.data.campaign.uniqueKey)},o.prototype.cancelScheduledSendOut=function(){this.sendType="",this.data.campaign.scheduledSendDate="",this.dateTimeProperty.value=""},o.prototype.setValidationErrors=function(e){var t;(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.validationErrors)&&(this.validationErrors=e.data.validationErrors,this.nsFormHelper.setErrors(this.formInformation,e),this.nsFormHelper.setErrors(this.formSend,e),this.notificationsService.error("Not saved","Campaign not saved due to validation errors."))},o.prototype.resetValidationErrors=function(){this.validationErrors=[]},o.$inject=["notificationsService","nsCampaignContentAppService","editorState","nsFormHelper","$scope","nsEditorService","nsCampaignService","nsServiceHelper"],t=o,e.ContentAppController=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i){this.workspaceService=t,this.notificationsService=i,this.btnTestPop3={state:umbraco.directives.umbButton.states.init}}t=e.Controllers||(e.Controllers={}),o.prototype.init=function(e){this.emailServiceProvider=e},o.prototype.testPop3=function(){var t=this,e={settings:this.emailServiceProvider.settings};this.workspaceService.testPop3Server(e,this.btnTestPop3,function(){t.notificationsService.success("Success","Connection successful")},function(e){t.notificationsService.error("Error","Could not connect: "+e.data.message)})},o.$inject=["$scope","nsWorkspaceService","notificationsService"],i=o,t.SmtpEmailServiceProviderController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){var t;function i(e){return{restrict:"E",replace:!0,template:"<p>hallo world from directive 123</p>",link:function(e,t,i){}}}t=e.Directives||(e.Directives={}),i.$inject=["$http"],t.fooBarDirective=i}(NewsletterStudio=NewsletterStudio||{}),function(n){var e;function t(e,t,r){return{restrict:"E",scope:{itemGroups:"=",ngModel:"="},replace:!0,templateUrl:n.UmbracoFacade.getNsViewPath("/common/directives/nsFontPicker/nsFontPicker.html"),link:function(o,s,e){o.showDropdown=!1,o.selectedItem=null,o.cssValues="",o.googleValue="",o.init=function(){var i=o.ngModel;n.Utilities.forEach(o.itemGroups,function(e,t){n.Utilities.forEach(e.definitions,function(e,t){e.fontFamilyValue===i&&(o.selectedItem=e),e.customFontDeclarationCss&&(o.cssValues=o.cssValues+e.customFontDeclarationCss+"\n"),e.googleFontsFamilyQueryStringValue&&(o.googleValue=o.googleValue+e.googleFontsFamilyQueryStringValue+"|")})}),t(function(){r.bind("click",o.onDocumentClick)},10)},o.$watch("ngModel",function(e,t){e!==t&&o.updateSelectionFromNgModel()}),o.updateSelectionFromNgModel=function(){var i=o.ngModel;n.Utilities.isNullOrEmpty(i)?o.selectedItem=null:n.Utilities.forEach(o.itemGroups,function(e,t){n.Utilities.forEach(e.definitions,function(e,t){e.fontFamilyValue===i&&(o.selectedItem=e)})})},o.onDocumentClick=function(e){if(!0===o.showDropdown){var t=0<$(s).has(e.target).length,i=s[0]==e.target;0==(t||i)&&o.$apply(function(){o.showDropdown=!1})}},o.toggleDropdown=function(){o.showDropdown=!o.showDropdown},o.setSelected=function(e){n.Utilities.isDefined(e)?o.ngModel=e.fontFamilyValue:o.ngModel=null,o.selectedItem=e,o.toggleDropdown()},o.init()}}}e=n.Directives||(n.Directives={}),t.$inject=["$http","$timeout","$document"],e.fontPickerDirective=t}(NewsletterStudio=NewsletterStudio||{}),function(o){var e;function t(e,t,i){return{restrict:"E",require:"ngModel",scope:{},replace:!1,templateUrl:o.UmbracoFacade.getNsViewPath("/common/directives/nsFontSizePicker/nsFontSizePicker.html"),link:function(e,t,i,o){o.$render=function(){e.value=o.$viewValue},e.valueChanged=function(){o.$setViewValue(e.value)}}}}e=o.Directives||(o.Directives={}),t.$inject=["$http","$timeout","$document"],e.fontSizePickerDirective=t}(NewsletterStudio=NewsletterStudio||{}),function(n){var e;function t(s,r){return{restrict:"E",scope:{email:"@",size:"@",color:"@",name:"@",status:"@"},replace:!0,templateUrl:n.UmbracoFacade.getNsViewPath("/common/directives/nsAvatar/nsAvatar.html"),link:function(i,e,t){i.init=function(){if(!n.Utilities.isNullOrEmpty(i.email)){i.realSize=n.Utilities.isNullOrEmpty(i.size)?"s":i.size,i.realColor=n.Utilities.isNullOrEmpty(i.color)?"secondary":i.color,i.realName=n.Utilities.isNullOrEmpty(i.name)?i.email:i.name,i.initials=function(e){if(e){var t=e.split(" "),i=t[0].substring(0,1);return 1<t.length&&(i+=t[t.length-1].substring(0,1)),i.toUpperCase()}return null}(i.realName),i.avatar=void 0;var e=r.getFromCache(i.email);void 0!==e?0<(i.avatar=e).length&&(i.showImage=!0):r.getAvatar(i.email,function(e){e&&0<e.length?(i.avatar=e,s(function(){i.showImage=!0},20)):i.avatar=void 0})}};var o=i.$watch("email",function(e,t){e!==t&&i.init()});i.init(),i.$on("$destroy",function(e,t){o()})}}}e=n.Directives||(n.Directives={}),t.$inject=["$timeout","nsAvatarService"],e.nsAvatarDirective=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(){this.restrict="E",this.replace=!0,this.templateUrl=e.UmbracoFacade.getNsViewPath("/common/directives/nsTextareaCounter/nsTextareaCounter.html"),this.scope={ngModel:"=ngModel",recommendedLength:"@"}}t=e.Directives||(e.Directives={}),o.prototype.link=function(e){},i=o,t.TextareaCounterDirective=i}(NewsletterStudio=NewsletterStudio||{}),function(c){var e;function t(a){return{restrict:"E",require:"ngModel",scope:{workspaceKey:"=",ngModel:"="},replace:!1,templateUrl:c.UmbracoFacade.getNsViewPath("/common/directives/nsRecipientListPicker/nsRecipientListPicker.html"),link:function(o,e,t,s){function i(e){o.workspaceKey=e,a.getRecipientLists(e,function(e){!function(e,i){c.Utilities.Array.isArray(i)&&c.Utilities.forEach(e,function(e){e.selectedLists=[],c.Utilities.forEach(e.lists,function(t){i.filter(function(e){return t.id===e}).shift()&&e.selectedLists.push(t.id)})})}(e.data,o.ngModel),o.recipientProviders=e.data})}var r,n;r=o.$watch("workspaceKey",function(e,t){c.Utilities.isNullOrEmpty(e)||e==t||i(e)}),n=o.$watch("recipientProviders",function(e,t){if(angular.isDefined(e)){var i=[];c.Utilities.forEach(o.recipientProviders,function(e){c.Utilities.forEach(e.selectedLists,function(e){i.push(e)})}),0<i.length?s.$setViewValue(i):s.$setViewValue([])}},!0),o.$on("$destroy",function(){r(),n()}),o.workspaceKey&&i(o.workspaceKey)}}}e=c.Directives||(c.Directives={}),t.$inject=["nsCampaignService"],e.recipientListPickerDirective=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t;function i(){return{restrict:"A",require:"^ngModel",link:function(i,e,t,o){var s=t.nsServerValidation;if(s&&""!==s){var r=s.split(",");i.$watch(t.ngModel,function(e,t){i.$applyAsync(function(){angular.forEach(r,function(e){o.$error[e]&&o.$setValidity(e,!0)})})})}}}}t=e.Directives||(e.Directives={}),i.$inject=[],t.serverValidationDirective=i}(NewsletterStudio=NewsletterStudio||{}),function(e){function t(){this.restrict="E",this.replace=!0,this.templateUrl=e.UmbracoFacade.getNsViewPath("/common/directives/nsCampaignReport/nsCampaignReport.html"),this.controller="NewsletterStudio.Directives.CampaignReportController",this.controllerAs="vm",this.scope={campaignKey:"=campaignKey",workspaceKey:"=workspaceKey",displayHeader:"=displayHeader"}}(e.Directives||(e.Directives={})).CampaignReportDirective=t}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i;function o(e,t,i,o,s,r,n,a,c){var l=this;this.$scope=e,this.notificationService=t,this.nsLocation=i,this.$routeParams=o,this.nsCampaignReportService=s,this.$filter=r,this.nsEditorService=n,this.$interval=a,this.localizationService=c,this.activeTab="overview",this.campaignKey="",this.workspaceKey="",this.searchFilter="",this.nextPage=function(e){l.updateRecipients(e)},this.prevPage=function(e){l.updateRecipients(e)},this.goToPage=function(e){l.updateRecipients(e)},this.campaignKey=e.campaignKey,this.workspaceKey=e.workspaceKey,this.displayHeader=e.displayHeader,this.execute(),this.intervalProcess=this.$interval(function(){"overview"==l.activeTab&&l.execute()},45e3);var p=o.nsTab;p&&this.setActiveTab(p),this.$scope.$on("$destroy",function(){l.$interval.cancel(l.intervalProcess)})}t=e.Directives||(e.Directives={}),o.prototype.execute=function(){var i=this;this.nsCampaignReportService.getOverviewFor(this.workspaceKey,this.campaignKey,function(t){i.localizationService.localizeMany(["ns_opens","ns_clicks"]).then(function(e){e.push("CTR"),i.setUpChart(t.data.chart.dates,t.data.chart.data,e,i.$filter)}),i.nsLocation.setTreePath(t.data),i.data=t.data})},o.prototype.openRecipient=function(e){var t=e.providerRecipientId,i=this.campaignKey,o=this.workspaceKey;this.nsEditorService.openCampaignReportRecipientDetails(i,t,o,function(e){},function(){})},o.prototype.setActiveTab=function(e){var t=this;if("recipients"===e){var i={workspaceKey:this.workspaceKey,campaignKey:this.campaignKey,filterStatus:"0",page:1};this.nsCampaignReportService.getRecipients(i,function(e){t.data.recipients=e.data})}this.activeTab=e},o.prototype.updateRecipients=function(e){var t=this;this.data.recipients.request.page=e,this.nsCampaignReportService.getRecipients(this.data.recipients.request,function(e){t.data.recipients=e.data})},o.prototype.recipientFilterStatusChanged=function(){this.data.recipients.request.filterUrl="",this.updateRecipients(1)},o.prototype.setUpChart=function(e,t,i,s){this.chart={},window.Chart.defaults.global.defaultFontFamily="Lato",this.chart.labels=e,this.chart.series=i,this.chart.data=t,this.chart.colors=["#62b8e4","#58c073","#b3b3b3"],this.chart.datasetOverride=[{fill:!1,borderWidth:4,pointRadius:5,pointHoverRadius:7,pointBorderWidth:1,yAxisID:"y-axis-1"},{fill:!1,borderWidth:4,pointRadius:5,pointHoverRadius:7,pointBorderWidth:1,yAxisID:"y-axis-1"},{fill:!1,borderWidth:4,pointRadius:5,pointHoverRadius:7,pointBorderWidth:1,yAxisID:"y-axis-2"}],this.chart.options={maintainAspectRatio:!1,legend:{display:!0,position:"bottom"},tooltips:{mode:"label",callbacks:{label:function(e,t){var i=t.datasets[e.datasetIndex].label+": "+e.yLabel;return 2===e.datasetIndex&&(i+="%"),i},title:function(e,t){var i=e[0].index,o=t.labels[i];return s("date")(o,"short")}}},layout:{padding:{left:0,right:0,top:10,bottom:0}},scales:{xAxes:[{gridLines:{display:!1,color:"#e7e7e7"},ticks:{callback:function(e){return s("date")(e,"HH")}}}],yAxes:[{id:"y-axis-1",scaleLabel:{display:!1,labelString:"Total"},ticks:{display:!1},display:!0,position:"left",gridLines:{display:!0,color:"#f0f0f0"}},{id:"y-axis-2",type:"linear",display:!1,position:"right",gridLines:{}}]}}},o.$inject=["$scope","notificationsService","nsLocation","$routeParams","nsCampaignReportService","$filter","nsEditorService","$interval","localizationService"],i=o,t.CampaignReportController=i}(NewsletterStudio=NewsletterStudio||{}),function(e){function t(){this.restrict="E",this.replace=!0,this.templateUrl=e.UmbracoFacade.getNsViewPath("/common/directives/nsRecipientDetails/nsRecipientDetails.html"),this.controller="NewsletterStudio.Directives.RecipientDetailsController",this.controllerAs="vm",this.scope={recipientKey:"=recipientKey",workspaceKey:"=workspaceKey",close:"&?",save:"&?"}}(e.Directives||(e.Directives={})).RecipientDetailsDirective=t}(NewsletterStudio=NewsletterStudio||{}),function(o){var e,t;function i(e,t,i,o,s,r,n,a,c,l){var p=this;this.$scope=e,this.notificationService=t,this.nsLocation=i,this.$routeParams=o,this.nsRecipientService=s,this.$filter=r,this.editorService=n,this.nsFormHelper=a,this.nsEditorService=c,this.localizationService=l,this.showActionMenu=!1,this.addSubscriptionVisible=!1,this.addSubscriptionShowError=!1,this.saveButtonState="",this.listStatusUpdates=[],this.recipientKey="",this.workspaceKey="",this.isModal=!1,this.recipientKey=e.recipientKey,this.workspaceKey=e.workspaceKey,this.isModal=void 0!==e.close,this.saveButtonState=umbraco.directives.umbButton.states.init,this.nsRecipientService.getDetails(this.workspaceKey,this.recipientKey,function(e){p.data=e.data,p.updateSelectableMailingLists(),p.isModal||p.nsLocation.setTreePath(e.data)})}e=o.Directives||(o.Directives={}),i.prototype.listStatusChanged=function(t,e){var i=this.listStatusUpdates.filter(function(e){return e.mailingListId==t.mailingListId.toString()}).shift();i?i.statusId=t.status:this.listStatusUpdates.push({subscriptionId:t.subscriptionId?t.subscriptionId.toString():"",mailingListId:t.mailingListId.toString(),statusId:t.status})},i.prototype.goToUrl=function(e){this.$scope.recipientDetails.$dirty||this.editorService.closeAll(),this.nsLocation.goToUrl(e)},i.prototype.timelineOpenTrackingTransactional=function(e){var t=parseInt(e);this.nsEditorService.openTransactionTrackingDetails(t)},i.prototype.showAddSubscription=function(){this.updateSelectableMailingLists(),this.addSubscriptionVisible=!0},i.prototype.addSubscription=function(){var t=this;if(o.Utilities.isNullOrEmpty(this.addSubscriptionMailingListId))this.addSubscriptionShowError=!0;else{var e=this.data.mailingLists.filter(function(e){return e.id==t.addSubscriptionMailingListId}).shift(),i={mailingListId:parseInt(e.id),name:e.label,status:"1",subscribed:(new Date).toISOString()};this.data.subscriptions.push(i),this.listStatusChanged(i),this.updateSelectableMailingLists(),this.addSubscriptionVisible=!1,this.addSubscriptionMailingListId=""}},i.prototype.close=function(){this.$scope.close()},i.prototype.resetErrorCount=function(){var e=this;this.nsRecipientService.resetErrorsForRecipient(this.recipientKey,function(){e.data.recipient.errorCount=0})},i.prototype.deleteRecipient=function(){var t=this;this.showActionMenu=!1,this.nsEditorService.confirmation({titleLocalizationKey:"ns_recipientDetails_confirmRemove_header",descriptionLocalizationKey:"ns_recipientDetails_confirmRemove_details",tokenValues:[this.data.recipient.firstname+" "+this.data.recipient.lastname],confirm:function(){t.nsRecipientService.remove(t.data.recipient.key,function(e){t.localizationService.localizeMany(["ns_removed","ns_recipientRemoved"]).then(function(e){t.notificationService.success(e[0],e[1])}),t.isModal?t.$scope.save&&t.$scope.save():window.history.back(-1)})}})},i.prototype.save=function(t){var i=this;if(this.nsFormHelper.validate(t)){this.saveButtonState=umbraco.directives.umbButton.states.busy;var e={recipient:this.data.recipient,listUpdates:this.listStatusUpdates};this.nsRecipientService.saveRecipientDetails(e,function(e){i.saveButtonState=umbraco.directives.umbButton.states.success,i.$scope.save&&i.$scope.save({model:"world from nsRecipientDetails-directive"}),i.data=e.data,i.updateSelectableMailingLists(),i.nsFormHelper.resetErrors(t)},function(e){i.nsFormHelper.setErrors(t,e),i.saveButtonState=umbraco.directives.umbButton.states.error})}},i.prototype.showTransactionalMessage=function(e){var t=parseInt(e);this.nsEditorService.openTransactionalViewMessage(t)},i.prototype.updateSelectableMailingLists=function(){var e=this,i=[];o.Utilities.forEach(this.data.mailingLists,function(t){e.data.subscriptions.filter(function(e){return e.mailingListId.toString()===t.id}).shift()||i.push(t)}),this.selectableLists=i},i.$inject=["$scope","notificationsService","nsLocation","$routeParams","nsRecipientService","$filter","editorService","nsFormHelper","nsEditorService","localizationService"],t=i,e.RecipientDetailsController=t}(NewsletterStudio=NewsletterStudio||{}),function(e){function t(){this.restrict="E",this.replace=!0,this.require="ngModel",this.templateUrl=e.UmbracoFacade.getNsViewPath("/common/directives/nsCheckboxList/nsCheckboxList.html"),this.controller="NewsletterStudio.Directives.CheckboxListController",this.controllerAs="vm",this.scope={options:"=options",idProperty:"@idProperty",labelProperty:"@labelProperty",labelLocalizationKeyProperty:"@labelLocalizationKeyProperty"}}(e.Directives||(e.Directives={})).CheckboxListDirective=t}(NewsletterStudio=NewsletterStudio||{}),function(t){var e,i;function o(e,t){var i=this;this.$scope=e,this.$element=t,this.useLabels=!1,this.required=!1,this.ngModelController=t.controller("ngModel"),this.idProperty=e.idProperty?e.idProperty:"id",this.labelProperty=e.labelProperty?e.labelProperty:"label",this.labelLocalizationKeyProperty=e.labelLocalizationKeyProperty?e.labelLocalizationKeyProperty:"localizationKey",this.required=void 0!==t[0].attributes.required||void 0!==t[0].attributes.ngRequired,this.ngModelController.$render=function(){i.init()},this.watchModel=this.$scope.$watch(function(){var e=i.ngModelController.$viewValue;return e?e.length:0},function(){i.updateLocalCheckedStatus()}),this.$scope.$on("$destroy",function(){i.watchModel()})}e=t.Directives||(t.Directives={}),o.prototype.init=function(){var i=this,o=this.ngModelController.$viewValue||[],s=[];this.$scope.options.forEach(function(e){var t={id:e[i.idProperty],label:e[i.labelProperty],localizationKey:e[i.labelLocalizationKeyProperty],checked:!1};-1<o.indexOf(t.id)&&(t.checked=!0),s.push(t)}),this.options=s,this.useLabels=0<this.options.filter(function(e){return!1===t.Utilities.isNullOrEmpty(e.label)}).length},o.prototype.updateLocalCheckedStatus=function(){var t=this.ngModelController.$viewValue;t=t||[],this.options.forEach(function(e){e.checked=-1<t.indexOf(e.id)})},o.prototype.changed=function(){var e=this.options.filter(function(e){return e.checked}).map(function(e){return e.id});this.ngModelController.$setViewValue(e),this.required&&e.length<1?this.ngModelController.$setValidity("required",!1):this.ngModelController.$setValidity("required",!0)},o.$inject=["$scope","$element"],i=o,e.CheckboxListController=i}(NewsletterStudio=NewsletterStudio||{}),function(s){!function(){function e(){this.transclude=!1,this.controller=t,this.controllerAs="vm",this.templateUrl=s.UmbracoFacade.getNsDirectiveViewPath("nsWorkspaceDashboard"),this.bindings={}}(s.Directives||(s.Directives={})).WorkspaceDashboardComponent=e;var t=(i.prototype.load=function(){var t=this;this.workspaceService.getDashboardOverview(this.nsLocation.workspaceKey(),function(e){t.nsLocation.setTreePath(e.data),t.data=e.data,window.Chart.defaults.global.defaultFontFamily="Lato",t.setupLatestChart(t.$filter),t.setupChartSubscribers(t.$filter),1==e.data.workspaceKeys.length&&(t.workspaceKey=e.data.workspaceKeys[0])})},i.prototype.onProgressCompleted=function(){this.load()},i.prototype.openDraft=function(e){if(1==e.isUmbracoContent)this.nsLocation.goToUrl("/umbraco/#/content/content/edit/"+e.umbracoContentKey);else{var t=this.nsLocation.getViewPath("campaign",e.key,e.workspaceKey);this.nsLocation.goToUrl(t)}},i.prototype.$onInit=function(){},i.prototype.createCampaign=function(){},i.prototype.createMailingList=function(){},i.prototype.setupLatestChart=function(e){if(this.data.lastSentCampaign){var t=[this.data.lastSentCampaign.clicked.percent,this.data.lastSentCampaign.opened.percent,this.data.lastSentCampaign.notOpened.percent,this.data.lastSentCampaign.error.percent];this.chart2={},this.chart2.labels=["Clicked","Opened","Not opened","Error"],this.chart2.data=t,this.chart2.colors=["#58C277","#7AB0E2","#F9D755","#F55C57"],this.chart2.options={responsive:!0,maintainAspectRatio:!0,legend:{display:!1},tooltips:{callbacks:{label:function(e,t){var i=t.datasets[e.datasetIndex].data[e.index];return t.labels[e.index]+": "+i+"%"}}},layout:{padding:{left:0,right:0,top:10,bottom:0}},scales:{}},this.chart2.datasetOverride={backgroundColor:["#58C277","#7AB0E2","#F9D755","#F55C57"],hoverBackgroundColor:["#58C277","#7AB0E2","#F9D755","#F55C57"],hoverBorderColor:["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"]}}},i.prototype.setupChartSubscribers=function(e){var t=this,i=[],o=[];s.Utilities.forEach(this.data.subscriberGrowth,function(e){i.push(t.$filter("date")(e.day,"EEEE")),o.push(e.count)}),i[6]="Today",this.chart={},this.chart.colors=["#C6C6C6"],this.chart.options={responsive:!0,maintainAspectRatio:!1,legend:{display:!1},layout:{padding:{left:0,right:0,top:0,bottom:0}}},this.chart.labels=i,this.chart.data=[o],this.chart.datasetOverride=[{label:"Subscribers",borderWidth:1,type:"bar",backgroundColor:"#C6C6C6",hoverBackgroundColor:"#C6C6C6",hoverBorderColor:"#C6C6C6"}]},i.$inject=["nsWorkspaceService","nsLocation","notificationsService","$filter"],i);function i(e,t,i,o){this.workspaceService=e,this.nsLocation=t,this.notificationService=i,this.$filter=o,this.workspaceKey="",this.workspaceKey=this.nsLocation.workspaceKey(),this.load()}}()}(NewsletterStudio=NewsletterStudio||{}),function(o){!function(){function e(){this.controller=t,this.controllerAs="vm",this.templateUrl=o.UmbracoFacade.getNsDirectiveViewPath("nsSendingProgress"),this.bindings={model:"=",allowedWorkspaceKeys:"<",contentKey:"<",onCompleted:"&?"}}(o.Directives||(o.Directives={})).SendingProgressComponent=e;var t=(i.prototype.$onInit=function(){this.$scope.vm.model?this.model=this.$scope.vm.model:this.model={processedItems:0,totalItems:0,processedPercent:0,campaignName:"",workspaceKey:""},this.$scope.vm.contentKey&&(this.contentKey=this.$scope.vm.contentKey),this.$scope.vm.allowedWorkspaceKeys&&(this.workspaceKeys=this.$scope.vm.allowedWorkspaceKeys),this.$scope.vm.onCompleted&&(this.onCompleted=this.$scope.vm.onCompleted)},i.$inject=["$scope","nsFrontendHub"],i);function i(e,t){var o=this;this.$scope=e,this.nsFrontendHub=t,this.updateProgress=function(e){if("CampaignProgress"===e.type){var t=e.meta.email;if(o.contentKey&&o.contentKey!==t.contentKey)return;if(o.workspaceKeys&&0<o.workspaceKeys.length)if(o.workspaceKeys.indexOf(t.workspaceKey)<0)return;var i={campaignName:t.campaignName,workspaceKey:t.workspaceKey,contentKey:t.contentKey,processedItems:t.processedItems,processedPercent:t.processedPercent,totalItems:t.totalItems};o.model=i,100==o.model.processedPercent&&o.onCompleted&&o.onCompleted()}},this.nsFrontendHub.initHub(function(e){e.on("Message",o.updateProgress),e.start(),o.hub=e}),e.$on("$destroy",function(){o.hub.off("Message",o.updateProgress)})}}()}(NewsletterStudio=NewsletterStudio||{}),function(o){!function(){function e(){this.transclude=!1,this.controller=t,this.controllerAs="vm",this.templateUrl=o.UmbracoFacade.getNsDirectiveViewPath("nsSlider"),this.bindings={max:"=",min:"<"},this.require={ngModel:"^ngModel"}}(o.Directives||(o.Directives={})).SliderComponent=e;var t=(i.prototype.$onInit=function(){var t=this;this.assetsService.loadCss("lib/nouislider/nouislider.min.css",this.$scope),this.assetsService.loadJs("lib/nouislider/nouislider.min.js",this.$scope).then(function(){t.$timeout(function(){var e=t.$element.find(".umb-range-slider")[0];t.createSlider(e)},0,!0)})},i.prototype.createSlider=function(e){var r=this;this.sliderInstance=e;var t={start:this.max,step:1,tooltips:[{to:function(e){return e==r.max?"Full":Math.round(e)},from:function(e){return e}}],format:{to:function(e){return Math.round(e)},from:function(e){return Math.round(e)}},range:{min:this.min,max:this.max},pips:{mode:"steps",density:100,filter:function(e){return e===r.min||e===r.max?1:-1}}};noUiSlider.create(this.sliderInstance,t),this.ngModel&&this.sliderInstance.noUiSlider.set(this.ngModel.$viewValue),this.$scope.$applyAsync(),this.ngModel.$render=function(){r.$timeout(function(){r.sliderInstance.noUiSlider.set(r.ngModel.$viewValue)},20)},this.watchMaxProperty=this.$scope.$watch("vm.max",function(e,t){e&&e!==t&&r.sliderInstance.noUiSlider.updateOptions({range:{min:r.min,max:e}},!0)}),this.sliderInstance.noUiSlider.on("change",function(e,t,i,o,s){r.ngModel.$setViewValue(e[0])})},i.$inject=["$element","$scope","$timeout","assetsService"],i);function i(e,t,i,o){var s=this;this.$element=e,this.$scope=t,this.$timeout=i,this.assetsService=o,angular.element(e).on("$destroy",function(){s.sliderInstance&&s.sliderInstance.noUiSlider.off(),s.watchMaxProperty&&s.watchMaxProperty()})}}()}(NewsletterStudio=NewsletterStudio||{}),function(o){!function(){function e(){this.transclude=!1,this.controller=t,this.controllerAs="vm",this.templateUrl=o.UmbracoFacade.getNsDirectiveViewPath("nsEmailAddressCollectionEditor"),this.bindings={},this.require={ngModel:"^ngModel"}}(o.Directives||(o.Directives={})).EmailAddressCollectionEditorComponent=e;var t=(i.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){e.data=e.ngModel.$viewValue,0==e.data.length&&e.data.push({email:"",displayName:""})}},i.prototype.add=function(){this.data.push({email:"",displayName:""})},i.prototype.remove=function(e){var t=this.data.indexOf(e);-1<t&&this.data.splice(t,1)},i.$inject=["nsWorkspaceService","nsLocation","notificationsService","$filter"],i);function i(e,t,i,o){this.workspaceService=e,this.nsLocation=t,this.notificationService=i,this.$filter=o,this.data=[]}}()}(NewsletterStudio=NewsletterStudio||{}),function(o){!function(){function e(){this.transclude=!1,this.controller=t,this.controllerAs="vm",this.templateUrl=o.UmbracoFacade.getNsDirectiveViewPath("nsDaysPicker"),this.bindings={},this.require={ngModel:"^ngModel"}}(o.Directives||(o.Directives={})).DaysPickerComponent=e;var t=(i.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){e.setSelectedOptionFromModel()}},i.prototype.setSelectedOptionFromModel=function(){if(0!=this.options.length){var t=this.ngModel.$viewValue.toString();this.options.filter(function(e){return e.value==t}).shift()?this.selectedOption=t:(this.selectedOption="custom",this.customDays=this.ngModel.$viewValue)}},i.prototype.optionChanged=function(){"custom"==this.selectedOption?this.customDays=parseInt(this.ngModel.$viewValue.toString()):this.ngModel.$setViewValue(parseInt(this.selectedOption))},i.prototype.customNumberChanged=function(){this.ngModel.$setViewValue(this.customDays)},i.prototype.appendDayValue=function(e,t){e.push({text:t+" "+this.daysText,value:t.toString()})},i.$inject=["localizationService"],i);function i(e){var i=this;this.localizationService=e,this.selectedOption="",this.customDays=3,this.options=[],this.daysText="",this.localizationService.localizeMany(["ns_days","ns_never","ns_custom"]).then(function(e){i.daysText=e[0].toLowerCase();var t=[];t.push({value:"0",text:e[1]}),i.appendDayValue(t,3),i.appendDayValue(t,7),i.appendDayValue(t,10),i.appendDayValue(t,15),i.appendDayValue(t,30),i.appendDayValue(t,60),i.appendDayValue(t,90),i.appendDayValue(t,365),t.push({value:"custom",text:e[2]}),i.options=t,i.setSelectedOptionFromModel()})}}()}(NewsletterStudio=NewsletterStudio||{}),function(o){!function(){function e(){this.transclude=!1,this.controller=t,this.controllerAs="vm",this.templateUrl=o.UmbracoFacade.getNsDirectiveViewPath("nsTransactionalLog"),this.bindings={transactionalEmailId:"<",log:"<"}}(o.Directives||(o.Directives={})).TransactionalLogComponent=e;var t=(i.prototype.$onInit=function(){this.setStatusFilter(this.log.logItemStatuses[0],!1)},i.prototype.setStatusFilter=function(e,t){var i=this;this.log.emails.filters.filterState=e.value,this.localizationService.localize(e.localizationKey).then(function(e){i.selectedFilterText=e}),!1!==t&&this.updatePagedList(1)},i.prototype.updatePagedList=function(e){var t=this;e&&(this.log.emails.filters.page=e),this.nsTransactionalService.getPagedTransactionalLogItems(this.log.emails.filters,function(e){t.log.emails.page=e.data})},i.prototype.openDetails=function(e){this.nsEditorService.openTransactionTrackingDetails(e.trackingTransactionalId)},i.$inject=["nsWorkspaceService","nsLocation","notificationsService","$filter","localizationService","nsTransactionalService","nsEditorService"],i);function i(e,t,i,o,s,r,n){var a=this;this.workspaceService=e,this.nsLocation=t,this.notificationService=i,this.$filter=o,this.localizationService=s,this.nsTransactionalService=r,this.nsEditorService=n,this.workspaceKey="",this.showFilterMenu=!1,this.statusFilterOptions=[],this.nextPage=function(e){a.updatePagedList(e)},this.prevPage=function(e){a.updatePagedList(e)},this.goToPage=function(e){a.updatePagedList(e)},this.workspaceKey=this.nsLocation.workspaceKey()}}()}(NewsletterStudio=NewsletterStudio||{}),function(o){!function(){function e(){this.transclude=!1,this.controller=t,this.controllerAs="vm",this.templateUrl=o.UmbracoFacade.getNsDirectiveViewPath("nsTransactionalEmailPicker"),this.bindings={max:"=",min:"=",workspaceKey:"="},this.require={ngModel:"^ngModel"}}(o.Directives||(o.Directives={})).TransactionalEmailPickerComponent=e;var t=(i.prototype.$onInit=function(){var i=this;this.sortableOptions={opacity:.7,disabled:!1,update:function(e,t){i.setAsDirty(),i.$timeout(function(){i.updateScopeModel()},50)}},this.ngModel.$render=function(){i.$timeout(function(){i.configuration={min:i.min,max:i.max},i.scopeValue=i.ngModel.$modelValue,i.serviceHelper.post("/TransactionalEmailPicker/GetModel",i.scopeValue,function(e){var t=e.data;i.workspaceKey&&(t.workspaces=t.workspaces.filter(function(e){return e.key===i.workspaceKey}),t.model=t.model.filter(function(e){return e.workspaceKey==i.workspaceKey})),i.data=t})},20)}},i.prototype.showAdd=function(){return!(0<this.configuration.max&&this.data.model.length>=this.configuration.max)},i.prototype.removeSelection=function(e){var t=this.data.model.indexOf(e);-1<t&&this.data.model.splice(t,1),this.selectedWorkspace=void 0,this.pickedWorkspaceKey=void 0,this.setAsDirty(),this.updateScopeModel()},i.prototype.setSelection=function(){var t=this,e=this.selectedWorkspace.transactionalEmails.filter(function(e){return e.key==t.pickedTransactionalEmailKey}).shift();e&&this.data.model.push({selectionType:"found",transactionalEmailKey:e.key,transactionalEmailName:e.name,workspaceKey:this.selectedWorkspace.key,workspaceName:this.selectedWorkspace.name}),this.selectedWorkspace=void 0,this.pickedWorkspaceKey=void 0,this.pickedTransactionalEmailKey=void 0,this.updateScopeModel(),this.setAsDirty(),this.showPickerModal=!1},i.prototype.openPicker=function(){1==this.data.workspaces.length&&(this.selectedWorkspace=this.data.workspaces[0],this.pickedWorkspaceKey=this.data.workspaces[0].key),this.showPickerModal=!0},i.prototype.closePicker=function(){this.showPickerModal=!1},i.prototype.workspaceChanged=function(){var t=this;this.selectedWorkspace=this.data.workspaces.filter(function(e){return e.key==t.pickedWorkspaceKey}).shift()},i.prototype.getTransactionalEmails=function(){var e=[];return this.selectedWorkspace&&(e=this.selectedWorkspace.transactionalEmails),e},i.prototype.validate=function(){this.$scope.transactionalEmailPickerForm&&(this.configuration.min>this.scopeValue.length?this.$scope.transactionalEmailPickerForm.minCount.$setValidity("minCount",!1):this.$scope.transactionalEmailPickerForm.minCount.$setValidity("minCount",!0),0<this.configuration.max&&this.configuration.max<this.scopeValue.length?this.$scope.transactionalEmailPickerForm.maxCount.$setValidity("maxCount",!1):this.$scope.transactionalEmailPickerForm.maxCount.$setValidity("maxCount",!0))},i.prototype.setAsDirty=function(){this.angularHelper.getCurrentForm(this.$scope).$setDirty()},i.prototype.updateScopeModel=function(){var t=[];angular.forEach(this.data.model,function(e){t.push({workspaceKey:e.workspaceKey,transactionalEmailKey:e.transactionalEmailKey})}),this.ngModel.$setViewValue(t),this.scopeValue=t,this.sortableOptions.disabled=t.length<=1,this.validate()},i.$inject=["$element","$scope","$timeout","assetsService","nsServiceHelper","angularHelper"],i);function i(e,t,i,o,s,r){var n=this;this.$element=e,this.$scope=t,this.$timeout=i,this.assetsService=o,this.serviceHelper=s,this.angularHelper=r,this.showPickerModal=!1,this.sortingEnabled=!1,this.subscriptionFormSubmitting=this.$scope.$on("formSubmitting",function(e,t){n.updateScopeModel()}),this.$scope.$on("$destroy",function(){n.subscriptionFormSubmitting&&n.subscriptionFormSubmitting()})}}()}(NewsletterStudio=NewsletterStudio||{}),function(s){!function(){function e(){this.transclude=!1,this.controller=t,this.controllerAs="vm",this.templateUrl=s.UmbracoFacade.getNsDirectiveViewPath("nsLinkEditor"),this.bindings={},this.require={ngModel:"^ngModel"}}(s.Directives||(s.Directives={})).LinkEditorComponent=e;var t=(i.prototype.$onInit=function(){var t=this;this.ngModel.$render=function(){var e=t.ngModel.$modelValue||"";s.Utilities.isDefined(t.ngModel.$modelValue)?e&&14<e.length&&"umb://document"===e.substring(0,14)?(t.linkType="content",t.entityResource.getByIds([e],"Document").then(function(e){t.setContentModelFromSelection(e[0])})):e&&14<e.length&&"umb://media"===e.substring(0,11)?(t.linkType="media",t.entityResource.getByIds([e],"Media").then(function(e){t.setMediaModelFromSelection(e[0])})):e&&2<e.length&&"{{"===e.substr(0,2)?(t.selectedMergeField=s.Utilities.MergeFields.ExtractPlaceholderFromMergeField(e),t.linkType="field"):e&&0<e.length?(t.destination.url=e,t.linkType="url"):t.setEmptySelection():t.setEmptySelection()}},i.prototype.setModel=function(){"content"===this.linkType?this.selectedContent?this.ngModel.$setViewValue(this.selectedContent.udi):this.ngModel.$setViewValue(""):"media"===this.linkType?this.selectedMedia?this.ngModel.$setViewValue(this.selectedMedia.udi):this.ngModel.$setViewValue(""):"url"===this.linkType?(this.ngModel.$setViewValue(this.destination.url),this.validation.invalidDestination=!1):"field"===this.linkType&&this.ngModel.$setViewValue(s.Utilities.MergeFields.WrapPlaceholderAsMergeField(this.selectedMergeField))},i.prototype.setEmptySelection=function(){this.selectedContent=void 0,this.selectedMedia=void 0,this.linkType="content",this.destination={url:""}},i.prototype.chooseContent=function(){var i=this,e={multiPicker:!1,submit:function(e){var t=e.selection[0];i.setContentModelFromSelection(t,!0),i.editorService.close()},close:function(e){i.editorService.close()}};this.editorService.contentPicker(e)},i.prototype.chooseMedia=function(){var i=this,e={multiPicker:!1,disableFolderSelect:!0,submit:function(e){var t=e.selection[0];i.setMediaModelFromSelection(t,!0),i.editorService.close()},close:function(e){i.editorService.close()}};this.editorService.mediaPicker(e)},i.prototype.setContentModelFromSelection=function(i,o){var s=this;i&&i.id&&this.entityResource.getUrl(i.id,"Document").then(function(e){var t={};t.name=i.name,t.udi=i.udi,t.icon=i.icon,t.description=e,s.selectedContent=t,s.validation.invalidDestination=!1,o&&s.setModel()})},i.prototype.setMediaModelFromSelection=function(i,o){var s=this;this.entityResource.getUrl(i.id,"Media").then(function(e){var t={};t.name=i.name,t.udi=i.udi,t.icon=i.icon,t.description=e,s.selectedMedia=t,s.validation.invalidDestination=!1,o&&s.setModel()})},i.prototype.validateDestination=function(){!this.destination.url||this.destination.url.length<8?this.validation.invalidDestination=!0:"http"!==this.destination.url.substring(0,4).toLowerCase()?this.validation.invalidDestination=!0:this.validation.invalidDestination=!1},i.prototype.setUpMergeFields=function(){var e=s.RichTextEditor.State.mergeFields,i=[],o={label:"Fields",options:[]};e.forEach(function(t){if(s.Utilities.isNullOrEmpty(t.groupText))o.options.push({label:t.text,value:t.placeholder});else{var e=i.filter(function(e){return e.label==t.groupText}).shift();e||(e={label:t.groupText,options:[]},i.push(e)),e.options.push({label:t.text,value:t.placeholder})}}),0<o.options.length&&i.push(o),this.mergeFieldGroups=i},i.prototype.removeSelectedContent=function(){this.selectedContent=void 0,this.setModel()},i.prototype.removeSelectedMedia=function(){this.selectedMedia=void 0,this.setModel()},i.prototype.destinationUrlChanged=function(){this.setModel()},i.prototype.mergeFieldChanged=function(){this.setModel()},i.$inject=["editorService","entityResource","$timeout"],i);function i(e,t,i){this.editorService=e,this.entityResource=t,this.$timeout=i,this.destination={url:""},this.validation={},this.setUpMergeFields()}}()}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i,o;function s(e,t,i,o,s,r,n){var a=this;this.$scope=e,this.serviceHelper=t,this.notificationsService=i,this.nsLocation=o,this.$timeout=s,this.angularHelper=r,this.nsDataEditorHelper=n,this.showPickerModal=!1,this.sortingEnabled=!1,this.configuration=n.getConfigurationOrDefault(e),this.sortableOptions={opacity:.7,disabled:!1,update:function(e,t){a.setAsDirty()}},this.subscriptionFormSubmitting=e.$on("formSubmitting",function(e,t){a.updateScopeModel()}),e.$on("$destroy",function(){a.subscriptionFormSubmitting&&a.subscriptionFormSubmitting()});var c=n.getStoredValue(e);this.serviceHelper.post("/MailingListPicker/GetModel",c,function(e){a.data=e.data})}t=e.Controllers||(e.Controllers={}),i=t.PropertyEditors||(t.PropertyEditors={}),s.prototype.removeSelection=function(e){var t=this.data.model.indexOf(e);-1<t&&this.data.model.splice(t,1),this.selectedWorkspace=void 0,this.pickedWorkspaceKey=void 0,this.setAsDirty(),this.updateScopeModel()},s.prototype.openPicker=function(){1==this.data.workspaces.length&&(this.selectedWorkspace=this.data.workspaces[0],this.pickedWorkspaceKey=this.data.workspaces[0].key),this.showPickerModal=!0},s.prototype.closePicker=function(){this.showPickerModal=!1},s.prototype.setSelection=function(){var t=this,e=this.selectedWorkspace.mailingLists.filter(function(e){return e.key==t.pickedMailingListKey}).shift();e&&this.data.model.push({selectionType:"found",mailingListKey:e.key,mailingListName:e.name,workspaceKey:this.selectedWorkspace.key,workspaceName:this.selectedWorkspace.name}),this.selectedWorkspace=void 0,this.pickedWorkspaceKey=void 0,this.pickedMailingListKey=void 0,this.updateScopeModel(),this.setAsDirty(),this.showPickerModal=!1},s.prototype.workspaceChanged=function(){var t=this;this.selectedWorkspace=this.data.workspaces.filter(function(e){return e.key==t.pickedWorkspaceKey}).shift()},s.prototype.getMailingLists=function(){var e=[];return this.selectedWorkspace&&(e=this.selectedWorkspace.mailingLists),e},s.prototype.showAdd=function(){return!(0<this.configuration.max&&this.data.model.length>=this.configuration.min)},s.prototype.validate=function(){this.$scope.mailingListPickerForm&&(0<this.configuration.min&&(this.configuration.min>this.$scope.model.value.length?this.$scope.mailingListPickerForm.minCount.$setValidity("minCount",!1):this.$scope.mailingListPickerForm.minCount.$setValidity("minCount",!0)),0<this.configuration.max&&(this.configuration.max<this.$scope.model.value.length?this.$scope.mailingListPickerForm.maxCount.$setValidity("maxCount",!1):this.$scope.mailingListPickerForm.maxCount.$setValidity("maxCount",!0)))},s.prototype.setAsDirty=function(){this.angularHelper.getCurrentForm(this.$scope).$setDirty()},s.prototype.updateScopeModel=function(){var t=[];angular.forEach(this.data.model,function(e){t.push({workspaceKey:e.workspaceKey,mailingListKey:e.mailingListKey})}),this.nsDataEditorHelper.setStoredValue(this.$scope,t),this.sortableOptions.disabled=t.length<=1,this.validate()},s.$inject=["$scope","nsServiceHelper","notificationsService","nsLocation","$timeout","angularHelper","nsDataEditorHelper"],o=s,i.MailingListPickerController=o}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i,o;function s(e,t,i,o,s,r,n){var a=this;this.$scope=e,this.serviceHelper=t,this.notificationsService=i,this.nsLocation=o,this.$timeout=s,this.angularHelper=r,this.nsDataEditorHelper=n,this.configuration=n.getConfigurationOrDefault(e),this.model=n.getStoredValue(e),e.$watch("vm.model",function(){a.nsDataEditorHelper.setStoredValue(a.$scope,a.model)})}t=e.Controllers||(e.Controllers={}),i=t.PropertyEditors||(t.PropertyEditors={}),s.$inject=["$scope","nsServiceHelper","notificationsService","nsLocation","$timeout","angularHelper","nsDataEditorHelper"],o=s,i.TransactionalEmailPickerController=o}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i,o;function s(e,t,i,o){var s=this;this.$scope=e,this.mediaResource=t,this.nsEmailEditorService=i,this.$timeout=o,this.imagePicker={alias:"photos",view:"mediapicker",editor:"Umbraco.MediaPicker",config:{multiPicker:!1,onlyImages:!0,disableFolderSelect:!0,ignoreUserStartNodes:!1,idType:"udi"},description:null,hideLabel:!1,label:"Image",value:""},e.$on("nsSelectedControlChanged",function(e,t){s.control=t,s.updateImagePicker()})}t=e.Editor||(e.Editor={}),i=t.Controllers||(t.Controllers={}),s.prototype.init=function(e,t){this.emailEditorVm=e,this.control=t,this.updateImagePicker(),this.setupWatchers(this.$scope)},s.prototype.updateImagePicker=function(){this.watchImageValue&&this.removeWatchers(),this.control.imageUdi?this.imagePicker.value=this.control.imageUdi:this.imagePicker.value="",this.setupWatchers(this.$scope)},s.prototype.updateControl=function(){var t=this;this.updateTimeout&&this.$timeout.cancel(this.updateTimeout),this.updateTimeout=this.$timeout(function(){if("image"===t.control.controlTypeAlias){var e=t.control;e.meta.sizeWasMax=e.imageSize==e.meta.imageMax,t.nsEmailEditorService.getImageControlData(e,function(e){t.control.meta=e.data.meta,t.control.imageSize=e.data.imageSize})}},500)},s.prototype.setupWatchers=function(e){var i=this;this.watchImageValue=e.$watch("editVm.imagePicker.value",function(e,t){e!==t&&(i.control.imageUdi=e,i.updateControl(),i.updateImagePicker())}),this.watchImageSize=e.$watch("editVm.control.imageSize",function(e,t){e!==t&&i.updateControl()}),this.watchImageHeight=e.$watch("editVm.control.imageHeight",function(e,t){e!==t&&i.updateControl()},!0),this.watchAspectRatio=e.$watch("editVm.control.aspectRatio",function(e,t){e!==t&&i.updateControl()}),this.watchPadding=e.$watch("editVm.control.padding",function(e,t){e!==t&&i.updateControl()},!0),this.watchColumns=e.$watch("editVm.control.columns",function(e,t){e!==t&&i.updateControl()})},s.prototype.removeWatchers=function(){this.watchImageValue(),this.watchImageSize(),this.watchImageHeight(),this.watchAspectRatio(),this.watchPadding(),this.watchColumns()},s.$inject=["$scope","mediaResource","nsEmailEditorService","$timeout"],o=s,i.ImageEditController=o}(NewsletterStudio=NewsletterStudio||{}),function(e){var t,i,o;function s(e,t,i,o){var s=this;this.$scope=e,this.mediaResource=t,this.nsEmailEditorService=i,this.$timeout=o,this.test="Controller value",e.$on("nsSelectedControlChanged",function(e,t){s.control=t})}t=e.Editor||(e.Editor={}),i=t.Controllers||(t.Controllers={}),s.prototype.init=function(e,t){var i=this;this.emailEditorVm=e,this.control=t,this.nsEmailEditorService.getMacros(e.themeConfiguration.name,function(e){i.macros=e.data})},s.prototype.macroChanged=function(){var t=this;if(this.control.macroPath&&""!=this.control.macroPath){var e=this.macros.filter(function(e){return e.id==t.control.macroPath}).shift();this.control.meta.label=e?e.label:""}else this.control.meta.label=""},s.$inject=["$scope","mediaResource","nsEmailEditorService","$timeout"],o=s,i.MacroEditController=o}(NewsletterStudio=NewsletterStudio||{}),function(e){var t=angular.module("umbraco");t.controller("NewsletterStudio.Controllers.DashboardController",e.Controllers.DashboardController),t.controller("NewsletterStudio.Controllers.PackageSettingsController",e.Controllers.PackageSettingsController),t.controller("NewsletterStudio.Controllers.CampaignsController",e.Controllers.CampaignsController),t.controller("NewsletterStudio.Controllers.CampaignController",e.Controllers.CampaignController),t.controller("NewsletterStudio.Controllers.CampaignReportController",e.Controllers.CampaignReportController),t.controller("NewsletterStudio.Controllers.ContactsOverviewController",e.Controllers.ContactsOverviewController),t.controller("NewsletterStudio.Controllers.WorkspaceOverviewController",e.Controllers.WorkspaceOverviewController),t.controller("NewsletterStudio.Controllers.TransactionalOverviewController",e.Controllers.TransactionalOverviewController),t.controller("NewsletterStudio.Controllers.TransactionalEmailsController",e.Controllers.TransactionalEmailsController),t.controller("NewsletterStudio.Controllers.TransactionalController",e.Controllers.TransactionalController),t.controller("NewsletterStudio.Controllers.MailingListsOverviewController",e.Controllers.MailingListsOverviewController),t.controller("NewsletterStudio.Controllers.MailingListDetailsController",e.Controllers.MailingListDetailsController),t.controller("NewsletterStudio.Controllers.RecipientsOverviewController",e.Controllers.RecipientsOverviewController),t.controller("NewsletterStudio.Controllers.RecipientDetailsController",e.Controllers.RecipientDetailsController),t.controller("NewsletterStudio.Controllers.WorkspaceSettingsController",e.Controllers.WorkspaceSettingsController),t.controller("NewsletterStudio.Controllers.AdministrationController",e.Controllers.AdministrationController),t.controller("NewsletterStudio.Controllers.AdministrationManageController",e.Controllers.AdministrationManageController),t.controller("NewsletterStudio.Controllers.AdministrationAboutController",e.Controllers.AdministrationAboutController),t.controller("NewsletterStudio.Controllers.Dialogs.ImportRecipientsController",e.Controllers.Dialogs.ImportRecipientsController),t.controller("NewsletterStudio.Controllers.Dialogs.CampaignReportRecipientController",e.Controllers.Dialogs.CampaignReportRecipientController),t.controller("NewsletterStudio.Controllers.Dialogs.RecipientsDetailsController",e.Controllers.Dialogs.RecipientsDetailsController),t.controller("NewsletterStudio.Controllers.Dialogs.TransactionalTrackingDetailsController",e.Controllers.Dialogs.TransactionalTrackingDetailsController),t.controller("NewsletterStudio.Controllers.Dialogs.TransactionalViewMessageController",e.Controllers.Dialogs.TransactionalViewMessageController),t.controller("NewsletterStudio.Controllers.ContentAppController",e.Controllers.ContentAppController),t.controller("NewsletterStudio.Controllers.PropertyEditors.MailingListPickerController",e.Controllers.PropertyEditors.MailingListPickerController),t.controller("NewsletterStudio.Controllers.PropertyEditors.TransactionalEmailPickerController",e.Controllers.PropertyEditors.TransactionalEmailPickerController),t.controller("NewsletterStudio.Controllers.SmtpEmailServiceProviderController",e.Controllers.SmtpEmailServiceProviderController),t.service("nsServiceHelper",e.Services.ServiceHelper),t.service("nsEditorService",e.Services.EditorService),t.service("nsAvatarService",e.Services.AvatarService),t.service("nsEmailEditorService",e.Services.EmailEditorService),t.service("nsLocation",e.Services.LocationService),t.service("nsCampaignService",e.Services.CampaignService),t.service("nsCampaignContentAppService",e.Services.CampaignContentAppService),t.service("nsCampaignReportService",e.Services.CampaignReportService),t.service("nsTransactionalService",e.Services.TransactionalService),t.service("nsMailingListService",e.Services.MailingListService),t.service("nsRecipientService",e.Services.RecipientService),t.service("nsWorkspaceService",e.Services.WorkspaceService),t.service("nsMergeFieldService",e.Services.MergeFieldService),t.service("nsUiHelper",e.Services.UiHelper),t.service("nsFrontendHub",e.Services.FrontendHub),t.service("nsDataEditorHelper",e.Services.DataEditorHelper),t.directive("fooBar",e.Directives.fooBarDirective),t.directive("nsFontPicker",e.Directives.fontPickerDirective),t.directive("nsFontSizePicker",e.Directives.fontSizePickerDirective),t.directive("nsAvatar",e.Directives.nsAvatarDirective),t.directive("nsTextareaCounter",[function(){return new e.Directives.TextareaCounterDirective}]),t.directive("nsRecipientListPicker",e.Directives.recipientListPickerDirective),t.directive("nsServerValidation",e.Directives.serverValidationDirective),t.directive("nsCampaignReport",[function(){return new e.Directives.CampaignReportDirective}]),t.controller("NewsletterStudio.Directives.CampaignReportController",e.Directives.CampaignReportController),t.directive("nsRecipientDetails",[function(){return new e.Directives.RecipientDetailsDirective}]),t.controller("NewsletterStudio.Directives.RecipientDetailsController",e.Directives.RecipientDetailsController),t.directive("nsCheckboxList",[function(){return new e.Directives.CheckboxListDirective}]),t.controller("NewsletterStudio.Directives.CheckboxListController",e.Directives.CheckboxListController),t.component("nsWorkspaceDashboard",new e.Directives.WorkspaceDashboardComponent),t.component("nsSendingProgress",new e.Directives.SendingProgressComponent),t.component("nsSlider",new e.Directives.SliderComponent),t.component("nsEmailAddressCollectionEditor",new e.Directives.EmailAddressCollectionEditorComponent),t.component("nsDaysPicker",new e.Directives.DaysPickerComponent),t.component("nsTransactionalLog",new e.Directives.TransactionalLogComponent),t.component("nsTransactionalEmailPicker",new e.Directives.TransactionalEmailPickerComponent),t.component("nsLinkEditor",new e.Directives.LinkEditorComponent),t.controller("NewsletterStudio.Controllers.EmailEditorControls.ImageEditController",e.Editor.Controllers.ImageEditController),t.controller("NewsletterStudio.Controllers.EmailEditorControls.MacroEditController",e.Editor.Controllers.MacroEditController)}(NewsletterStudio=NewsletterStudio||{});