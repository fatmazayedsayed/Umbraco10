var autoScroll=function(){"use strict";function C(o,e){return"function"==typeof(o=function(e,t){return void 0===e?void 0===t?e:t:e}(o,e))?function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return!!o.apply(this,t)}:o?function(){return!0}:function(){return!1}}var n,o=["webkit","moz","ms","o"],E=function(){for(var e=0,t=o.length;e<t&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[o[e]+"RequestAnimationFrame"];var r;return window.requestAnimationFrame||(r=0,window.requestAnimationFrame=function(e){var t=(new Date).getTime(),n=Math.max(0,16-t-r),o=window.setTimeout(function(){return e(t+n)},n);return r=t+n,o}),window.requestAnimationFrame.bind(window)}(),S=function(){for(var e=0,t=o.length;e<t&&!window.cancelAnimationFrame;++e)window.cancelAnimationFrame=window[o[e]+"CancelAnimationFrame"]||window[o[e]+"CancelRequestAnimationFrame"];return window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){window.clearTimeout(e)}),window.cancelAnimationFrame.bind(window)}(),t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=function(e){return null!=e&&"object"===(void 0===e?"undefined":t(e))&&1===e.nodeType&&"object"===t(e.style)&&"object"===t(e.ownerDocument)},e=(n=Math.pow(2,53)-1,function(e,t,n){var o,r,i,l=1<arguments.length?t:void 0;if(void 0!==l){if(!p(l))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(o=n)}var a,c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!p(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(-1<["string","number","boolean","symbol"].indexOf(typeof e))return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){r=p(this)?Object(new this):[];var u,s,d=c.call(e);if(null==d)throw new TypeError("Array.from requires an array-like or iterable object");for(i=0;;){if(a=d.next(),!(u=!Boolean(a.done)&&a))return r.length=i,r;s=u.value,r[i]=l?l.call(o,s,i):s,i++}}else{var g=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var f,m=v(g.length);for(r=p(this)?Object(new this(m)):new Array(m),i=0;i<m;)f=g[i],r[i]=l?l.call(o,f,i):f,i++;r.length=m}return r});function p(e){return"function"==typeof e}function v(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(0<t?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),n)}"function"==typeof Array.from&&Array.from,Array.isArray,Object.prototype.toString;function k(e,t){if(t=$(t,!0),!r(t))return-1;for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function T(e,t){return-1!==k(e,t)}function O(e){for(var t=arguments.length,n=Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return function(e,t){for(var n=0;n<t.length;n++)T(e,t[n])||e.push(t[n]);return t}(e,n=n.map($))}function $(e,t){if("string"==typeof e)try{return document.querySelector(e)}catch(e){throw e}if(!r(e)&&!t)throw new TypeError(e+" is not a DOM element.");return e}var A=function(r,e){var i;return i="function"==typeof(e=e||{}).allowUpdate?e.allowUpdate:function(){return!0},function(e){if(e=e||window.event,r.target=e.target||e.srcElement||e.originalTarget,r.element=this,r.type=e.type,i(e))if(e.targetTouches)r.x=e.targetTouches[0].clientX,r.y=e.targetTouches[0].clientY,r.pageX=e.pageX,r.pageY=e.pageY;else{if(null===e.pageX&&null!==e.clientX){var t=e.target&&e.target.ownerDocument||document,n=t.documentElement,o=t.body;r.pageX=e.clientX+(n&&n.scrollLeft||o&&o.scrollLeft||0)-(n&&n.clientLeft||o&&o.clientLeft||0),r.pageY=e.clientY+(n&&n.scrollTop||o&&o.scrollTop||0)-(n&&n.clientTop||o&&o.clientTop||0)}else r.pageX=e.pageX,r.pageY=e.pageY;r.x=e.clientX,r.y=e.clientY}}};function M(t){if(t===window)return function(){var e={top:{value:0,enumerable:!0},left:{value:0,enumerable:!0},right:{value:window.innerWidth,enumerable:!0},bottom:{value:window.innerHeight,enumerable:!0},width:{value:window.innerWidth,enumerable:!0},height:{value:window.innerHeight,enumerable:!0},x:{value:0,enumerable:!0},y:{value:0,enumerable:!0}};if(Object.create)return Object.create({},e);var t={};return Object.defineProperties(t,e),t}();try{var e=t.getBoundingClientRect();return void 0===e.x&&(rext.x=e.left,e.y=e.top),e}catch(e){throw new TypeError("Can't call getBoundingClientRect on "+t)}}function i(){}var l="function"!=typeof Object.create?function(e,t){if(e!==Object(e)&&null!==e)throw TypeError("Argument must be an object, or null");i.prototype=e||{};var n=new i;return i.prototype=null,void 0!==t&&Object.defineProperties(n,t),null===e&&(n.__proto__=null),n}:Object.create,a=["altKey","button","buttons","clientX","clientY","ctrlKey","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","region","relatedTarget","screenX","screenY","shiftKey","which","x","y"];function L(e){var l={screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,button:0,buttons:1,relatedTarget:null,region:null};function t(e){for(var t=0;t<a.length;t++)l[a[t]]=e[a[t]]}return void 0!==e&&e.addEventListener("mousemove",t),{destroy:function(){e&&e.removeEventListener("mousemove",t,!1),l=null},dispatch:MouseEvent?function(e,t,n){var o=new MouseEvent("mousemove",c(l,t));return u(o,n),e.dispatchEvent(o)}:"function"==typeof document.createEvent?function(e,t,n){var o=c(l,t),r=document.createEvent("MouseEvents");return r.initMouseEvent("mousemove",!0,!0,window,0,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,o.relatedTarget),u(r,n),e.dispatchEvent(r)}:"function"==typeof document.createEventObject?function(e,t,n){var o=document.createEventObject(),r=c(l,t);for(var i in r)o[i]=r[i];return u(o,n),e.dispatchEvent(o)}:void 0}}function c(e,t){t=t||{};for(var n=l(e),o=0;o<a.length;o++)void 0!==t[a[o]]&&(n[a[o]]=t[a[o]]);return n}function u(e,t){e.data=t||{},e.dispatched="mousemove"}function s(o){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=this,t=4,n=!1;this.margin=e.margin||-1,this.scrollWhenOutside=e.scrollWhenOutside||!1;var i={},l=!1,a=A(i,{allowUpdate:function(e){return!e.dispatched}});window.addEventListener("mousemove",a,!1),window.addEventListener("touchmove",a,!1),isNaN(e.maxSpeed)||(t=e.maxSpeed),this.autoScroll=C(e.autoScroll),this.sync=C(e.sync,!1),this.destroy=function(){window.removeEventListener("mousemove",a,!1),window.removeEventListener("touchmove",a,!1),window.removeEventListener("mousedown",p,!1),window.removeEventListener("touchstart",p,!1),window.removeEventListener("mouseup",v,!1),window.removeEventListener("touchend",v,!1),window.removeEventListener("scroll",m,!0),o=[]},this.add=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return O.apply(void 0,[o].concat(t)),this},this.remove=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(o){for(var e=arguments.length,t=Array(1<e?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return t.map($).reduce(function(e,t){var n=k(o,t);return-1!==n?e.concat(o.splice(n,1)):e},[])}.apply(void 0,[o].concat(t))};var c,u=null,s=void 0;"[object Array]"!==Object.prototype.toString.call(o)&&(o=[o]),c=o,o=[],c.forEach(function(e){e===window?u=window:r.add(e)}),Object.defineProperties(this,{down:{get:function(){return l}},maxSpeed:{get:function(){return t}},point:{get:function(){return i}},scrolling:{get:function(){return n}}});var d=null,g=void 0,f=L();function m(e){for(var t=0;t<o.length;t++)if(o[t]===e.target){n=!0;break}n&&E(function(){return n=!1})}function p(){l=!0}function v(){l=!1,S(g),S(s)}function h(){for(var e=null,t=0;t<o.length;t++)R(i,o[t])&&(e=o[t]);return e}function w(e){if(e.dispatched)return!1;if(r.autoScroll()){var t=e.target,n=document.body;d&&!R(i,d)&&(r.scrollWhenOutside||(d=null)),(t=t&&t.parentNode===n?h():(t=function(e){if(!e)return null;if(d===e)return e;if(T(o,e))return e;for(;e=e.parentNode;)if(T(o,e))return e;return null}(t))||h())&&t!==d&&(d=t),u&&(S(s),s=E(b)),d&&(S(g),g=E(y))}}function b(){x(u),S(s),s=E(b)}function y(){d&&(x(d),S(g),g=E(y))}function x(e){var t=M(e),n=void 0,o=void 0;n=i.x<t.left+r.margin?Math.floor(Math.max(-1,(i.x-t.left)/r.margin-1)*r.maxSpeed):i.x>t.right-r.margin?Math.ceil(Math.min(1,(i.x-t.right)/r.margin+1)*r.maxSpeed):0,o=i.y<t.top+r.margin?Math.floor(Math.max(-1,(i.y-t.top)/r.margin-1)*r.maxSpeed):i.y>t.bottom-r.margin?Math.ceil(Math.min(1,(i.y-t.bottom)/r.margin+1)*r.maxSpeed):0,r.sync()&&f.dispatch(e,{clientX:i.x+n,clientY:i.y+o,pageX:i.pageX+n,pageY:i.pageY+o}),setTimeout(function(){o&&function(e,t){e===window?window.scrollTo(e.pageXOffset,e.pageYOffset+t):e.scrollTop+=t}(e,o),n&&function(e,t){e===window?window.scrollTo(e.pageXOffset+t,e.pageYOffset):e.scrollLeft+=t}(e,n)})}window.addEventListener("mousedown",p,!1),window.addEventListener("touchstart",p,!1),window.addEventListener("mouseup",v,!1),window.addEventListener("touchend",v,!1),window.addEventListener("mousemove",w,!1),window.addEventListener("touchmove",w,!1),window.addEventListener("mouseleave",function(){l=!1},!1),window.addEventListener("scroll",m,!0)}function R(e,t,n){return n?e.y>n.top&&e.y<n.bottom&&e.x>n.left&&e.x<n.right:function(e,t){var n=M(t);return e.y>n.top&&e.y<n.bottom&&e.x>n.left&&e.x<n.right}(e,t)}return function(e,t){return new s(e,t)}}();angular.module("umbraco").directive("emClickOutside",["$document","$timeout",function(o,a){return{link:function(r,i,l){function n(e){var t=0<$(".pcr-app").has(e.target).length,n=0<$(i).has(e.target).length,o=i[0]==e.target;0==(n||o||t)&&r.$apply(l.emClickOutside)}r.$watch(l.isActive,function(e,t){e!==t&&1==e?a(function(){o.bind("click",n)},10):e!==t&&0==e&&o.unbind("click",n)})}}}]),function(){"use strict";angular.module("umbraco").directive("nsColorPicker",[function(){return{restrict:"E",scope:{ngModel:"=",colorList:"=?",pickerTo:"@"},link:function(n,e,t){if(n.pickerTo=n.pickerTo||"right",n.ngModel=n.ngModel?n.ngModel.toUpperCase():"",n.selectableColors=[],n.colorList){var o=n.colorList.split(","),r=[];o.forEach(function(e){-1===r.indexOf(e)&&r.push(e)}),n.selectableColors=r}n.colorList=n.colorList||[];function i(e,t){n.$apply(function(){n.ngModel=t.getColor().toHEXA().toString(0)})}function l(e,t){t.hide(),n.shouldShowPalette=!1,n.shouldCloseOnClickOutside=!1}var a=e.find(".pickr-button")[0],c=function(t,e){var n=Pickr.create({el:e,theme:"monolith",comparison:!1,useAsButton:!0,default:t.ngModel||"#438686",swatches:[],components:{preview:!0,opacity:!1,comparison:!1,hue:!0,interaction:{palette:!1,input:!0,clear:!1,save:!0}}});return n.on("show",function(e){t.$apply(function(){t.shouldCloseOnClickOutside=!1})}),n.on("hide",function(e){t.$apply(function(){t.shouldCloseOnClickOutside=!0})}),n}(n,a);c.on("save",l),c.on("change",i),n.shouldCloseOnClickOutside=!1,n.showPalette=function(e){n.shouldShowPalette=!n.shouldShowPalette,n.shouldCloseOnClickOutside=!0},n.select=function(e){e.currentTarget.setSelectionRange(0,e.currentTarget.value.length)},n.setColor=function(e){c.off("save",l),c.off("change",i),n.ngModel=e,setTimeout(function(){c.setColor(e),c.on("save",l),c.on("change",i)},10)},n.clickOutside=function(){n.shouldShowPalette=!1,n.shouldCloseOnClickOutside=!1},n.addHexIfNeeded=function(){n.ngModel&&0<n.ngModel.length&&"#"!==n.ngModel.substr(0,1)&&(n.ngModel="#"+n.ngModel)},n.isLightColor=function(e){var t,n,o;return o=e.match(/^rgb/)?(t=(e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],n=e[2],e[3]):(t=(e=+("0x"+e.slice(1).replace(e.length<5&&/./g,"$&$&")))>>16,n=e>>8&255,255&e),240<Math.sqrt(t*t*.299+n*n*.587+o*o*.114)},n.init=function(){},n.init(),n.$on("$destroy",function(){c.destroyAndRemove()})},templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsColorPicker/nsColorPicker.html")}}])}(),function(){"use strict";angular.module("umbraco").directive("nsEmailEditor",["$http",function(){return{restrict:"E",scope:{email:"=?",controlTypes:"=?",toolboxControls:"=?",theme:"=?",fonts:"=?"},controller:["$scope","$http","nsServiceHelper","dragulaService","navigationService","editorService","mediaResource","$timeout",function(n,e,t,o,r,i,l,a){n.$on("$destroy",function(){$("body").removeClass("ns-email-editor-fullscreen")}),$("body").addClass("ns-email-editor-fullscreen");var c=document.querySelector(".email-editor-layout-wrapper"),u=autoScroll(c,{margin:70,maxSpeed:20,scrollWhenOutside:!0,autoScroll:function(){return $(".email-editor-canvas").hasClass("gu-unselectable")}});n.$on("$destroy",function(){u.destroy()});var s=this;return s.toolboxTabActive="insert",s.addRowState="init",s.themeConfiguration=n.theme.configuration,s.themeColor=n.theme.configuration.backgroundColor,s.themeColors=n.theme.configuration.selectableColors,s.setToolboxTab=function(e){if("row"===e&&!s.selectedRow){if(!s.selectedControl)return;var t=s.getRowForControl(this.selectedControl);t&&(s.selectedControl=void 0,s.toggleSelectRow(t))}"control"===e&&!s.selectedControl||(s.toolboxTabActive=e)},o.options(n,"controls-bag",{revertOnSpill:!0,mirrorContainer:document.querySelector(".email-editor-canvas"),invalid:function(e,t){return"placeholder"===t.className},copy:function(e,t){return t===document.querySelector("*[data-toolbox]")},accepts:function(e,t){return t!==document.querySelector("*[data-toolbox]")}}),n.$on("controls-bag.over",function(e,t,n){n.addClass("ex-over")}),n.$on("controls-bag.out",function(e,t,n){n.removeClass("ex-over")}),n.$on("controls-bag.drop-model",function(e,t,n,o,r){var i=s.getRowForControl(r),l={columns:s.getColumnForControl(r).columns,stackOnSmallScreen:i.stackOnSmallScreen};r.rowAndColumnInfo=l,(!s.selectedControl||s.selectedControl&&s.selectedControl!==r)&&s.setSelectedControl(r)}),o.options(n,"rows-bag",{mirrorContainer:document.querySelector(".email-editor-canvas"),moves:function(e,t,n){return-1<n.className.indexOf("handle")}}),s.getRowForControl=function(n){var o=void 0;return angular.forEach(s.email.rows,function(t){angular.forEach(t.columns,function(e){-1<e.controls.indexOf(n)&&(o=t)})}),o},s.getColumnForControl=function(t){var n=void 0;return angular.forEach(s.email.rows,function(e){angular.forEach(e.columns,function(e){-1<e.controls.indexOf(t)&&(n=e)})}),n},s.toggleSelectControl=function(e,t){e.stopPropagation(),s.setSelectedControl(t)},s.setSelectedControl=function(e){NewsletterStudio.Utilities.isDefined(e)&&(s.selectedControl&&s.selectedControl==e?(s.selectedControl=void 0,s.setToolboxTab("insert")):(n.$broadcast("nsSelectedControlChanged",e),s.selectedControl=e,s.setToolboxTab("control"),s.selectedRow=void 0))},s.toggleSelectRow=function(e){s.selectedRow&&s.selectedRow==e?(s.selectedRow=void 0,s.setToolboxTab("insert"),s.rowImageWatch&&s.rowImageWatch()):(s.selectedRow=e,s.setToolboxTab("row"),s.selectedControl=void 0,s.rowImage={alias:"photos",view:"mediapicker",editor:"Umbraco.MediaPicker",config:{multiPicker:!1,onlyImages:!0,disableFolderSelect:!0,ignoreUserStartNodes:!1,idType:"udi"},description:null,hideLabel:!1,label:"Image",value:s.selectedRow.backgroundImage?s.selectedRow.backgroundImage:""},s.rowImageWatch=n.$watch("vm.rowImage.value",function(e,t){e!==t&&(s.selectedRow.backgroundImage=e,NewsletterStudio.Utilities.isNullOrEmpty(s.selectedRow.backgroundImage)?s.selectedRow.backgroundImageUrl="":l.getById(s.selectedRow.backgroundImage).then(function(e){s.selectedRow.backgroundImageUrl=e.mediaLink}))}))},s.getRowBackgroundStyle=function(e){if(e.backgroundImageUrl){var t=e.fullwidth?2800:1200;return"url('"+e.backgroundImageUrl+"?width="+t+"')"}},s.removeControl=function(e,t,n){if(e&&e.stopPropagation(),s.selectedControl===n&&(s.selectedControl=void 0,"control"===s.toolboxTabActive&&s.setToolboxTab("insert")),t&&t.controls){var o=t.controls.indexOf(n);-1<o&&t.controls.splice(o,1),n=void 0}},s.duplicateControl=function(e,t,n){e.stopPropagation();var o=t.controls.indexOf(n),r=angular.copy(n);t.controls.splice(o+1,0,r)},s.removeRow=function(e,t){e.stopPropagation(),t.columns.forEach(function(e){e.controls.forEach(function(e){s.selectedControl===e&&(s.selectedControl=void 0,"control"===s.toolboxTabActive&&s.setToolboxTab("insert"))})}),s.selectedRow===t&&(s.selectedRow=void 0,s.setToolboxTab("insert"));var n=s.email.rows.indexOf(t);-1<n&&s.email.rows.splice(n,1),t=void 0},s.duplicateRow=function(e,t){e.stopPropagation();var n=s.email.rows.indexOf(t),o=angular.copy(t);s.email.rows.splice(n+1,0,o)},s.addRow=function(e){var t={};1===e&&(t={backgroundColor:"",columns:[{columns:4,controls:[]}]}),2===e?t={backgroundColor:"",columns:[{columns:2,controls:[]},{columns:2,controls:[]}]}:4===e&&(t={backgroundColor:"",columns:[{columns:1,controls:[]},{columns:1,controls:[]},{columns:1,controls:[]},{columns:1,controls:[]}]}),s.email.rows.push(t),s.addRowState="init",s.selectedRow=t,s.setToolboxTab("insert")},s.getViewRender=function(e){if(e){var t=e.controlTypeAlias;return n.controlTypes.filter(function(e){return e.alias==t}).shift().viewRender}return""},s.getViewEdit=function(e){if(e){var t=e.controlTypeAlias;return n.controlTypes.filter(function(e){return e.alias==t}).shift().viewEdit}return""},n.toolboxControls?s.source=n.toolboxControls:s.source=[],n.email?(s.email=n.email,s.email.settings||(s.email.settings={})):s.email={rows:[],settings:{}},s.toggleOptionsAlign=[{text:"Left",value:"left",tooltipKey:"ns_alignLeft",iconSvg:'<?xml version="1.0" encoding="iso-8859-1"?><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 426.667 426.667" style="enable-background:new 0 0 426.667 426.667;" xml:space="preserve"><g><g><rect y="320" width="256" height="42.667"/></g></g><g><g><rect y="149.333" width="320" height="42.667"/></g></g><g><g><rect y="64" width="426.667" height="42.667"/></g></g><g><g><rect y="234.667" width="384" height="42.667"/></g></svg>'},{text:"Center",value:"center",tooltipKey:"ns_alignCenter",iconSvg:'<?xml version="1.0" encoding="iso-8859-1"?><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 426.667 426.667" style="enable-background:new 0 0 426.667 426.667;" xml:space="preserve"><g><g><rect x="85.333" y="320" width="256" height="42.667"/></g></g><g><g><rect x="64" y="149.333" width="298.667" height="42.667"/></g></g><g><g><rect y="64" width="426.667" height="42.667"/></g></g><g><g><rect x="21.333" y="234.667" width="384" height="42.667"/></g></svg>'},{text:"Right",value:"right",tooltipKey:"ns_alignRight",iconSvg:'<?xml version="1.0" encoding="iso-8859-1"?><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 426.667 426.667" style="enable-background:new 0 0 426.667 426.667;" xml:space="preserve"><g><g><rect x="170.667" y="320" width="256" height="42.667"/></g></g><g><g><rect x="106.667" y="149.333" width="320" height="42.667"/></g></g><g><g><rect y="64" width="426.667" height="42.667"/></g></g><g><g><rect x="42.667" y="234.667" width="384" height="42.667"/></g></g></svg>'}],s.themeBackgroundColor=function(e){return e||s.themeConfiguration.backgroundColor},s.settingWithFallback=function(e,t){return e||(s.email.settings&&void 0!==s.email.settings[t]&&""!==s.email.settings[t]?s.email.settings[t]:s.themeConfiguration[t])},n.$watch("vm.email",function(e,t){n.email=e,angular.forEach(e.rows,function(t){NewsletterStudio.Utilities.isNullOrEmpty(t.backgroundImage)||NewsletterStudio.Utilities.isNullOrEmpty(t.backgroundImageUrl)&&l.getById(t.backgroundImage).then(function(e){t.backgroundImageUrl=e.mediaLink})})},!0),s.fonts=n.fonts,window.addEventListener("keyup",function(e){if("Delete"===e.key&&(!e.target||!e.target.nodeName||"INPUT"!==e.target.nodeName)&&s.selectedControl){var t=s.getColumnForControl(s.selectedControl);n.$apply(function(){s.removeControl(void 0,t,s.selectedControl)})}}),s}],controllerAs:"vm",templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsEmailEditor/nsEmailEditor.html")}}])}(),function(){"use strict";angular.module("umbraco").directive("nsFileUpload",["$http",function(e){return{scope:!0,link:function(o,e,t){e.bind("change",function(e){for(var t=e.target.files,n=0;n<t.length;n++)o.$emit("fileSelected",{file:t[n]})})}}}])}(),function(){"use strict";angular.module("umbraco").directive("nsHtml",[function(){return{restrict:"E",replace:!0,scope:{html:"="},link:function(n,o,e){n.$watch("html",function(e,t){o.html(n.html)})}}}])}(),angular.module("umbraco").directive("nsLocalize",["$log","localizationService",function(e,a){return{restrict:"A",link:function(r,i,l){l.nsLocalize.split(",").forEach(function(t){var e="nsLocalize"+t[0].toUpperCase()+t.substr(1,t.length-1)+"Key",n=l[e];if(n){var o=a.tokenize(n,r);a.localize(o.key,o.tokens).then(function(e){i.attr(t,e)})}})}}}]).directive("nsLocalize",["$log","localizationService",function(e,t){return{restrict:"E",scope:{key:"@",lowerCaseFirst:"@"},replace:!0,link:function(n,o,r){var e=n.key;n.text="",t.localize(e).then(function(e){n.text=e,function(){var e=n.text,t=r.lowerCaseFirst;t&&"true"===t.toLowerCase()&&(e=NewsletterStudio.Utilities.String.toFirstLower(e)),o.html(e)}()})}}}]),angular.module("umbraco").directive("nsLocalizeInner",["$log","localizationService",function(e,r){return{restrict:"A",link:function(e,t,n){var o=n.nsLocalizeInner;o&&!NewsletterStudio.Utilities.isNullOrEmpty(o)&&r.localize(o).then(function(e){t.html(e)})}}}]),function(){"use strict";angular.module("umbraco").directive("nsMarginEditor",[function(){return{restrict:"E",scope:{ngModel:"="},link:function(o,e,t){o.defaultPadding=10,o.init=function(){if(o.ngModel){o.paddingTop={value:o.ngModel.top},o.paddingBottom={value:o.ngModel.bottom},o.paddingLeft={value:o.ngModel.left};var e,t=!(o.paddingRight={value:o.ngModel.right});try{t=4*(e=parseInt(o.paddingTop.value))===e+parseInt(o.paddingBottom.value)+parseInt(o.paddingLeft.value)+parseInt(o.paddingRight.value)}catch(e){t=!1,console.log(e)}t?(o.expanded=!1,o.paddingAll=o.paddingTop.value):o.expanded=!0}else o.ngModel={},o.setDefault()},o.expand=function(){o.paddingTop={value:o.paddingAll},o.paddingBottom={value:o.paddingAll},o.paddingLeft={value:o.paddingAll},o.paddingRight={value:o.paddingAll},o.expanded=!0},o.collapse=function(){o.paddingAll=o.defaultPadding,o.paddingTop={value:o.paddingAll},o.paddingBottom={value:o.paddingAll},o.paddingLeft={value:o.paddingAll},o.paddingRight={value:o.paddingAll},o.expanded=!1},o.up=function(e){e.value=parseInt(e.value)+1},o.down=function(e){0<=parseInt(e.value)-1&&(e.value=parseInt(e.value)-1)},o.setDefault=function(){o.paddingAll=10,o.paddingTop={value:10},o.paddingBottom={value:10},o.paddingLeft={value:10},o.paddingRight={value:10}},o.select=function(e){e.currentTarget.setSelectionRange(0,e.currentTarget.value.length)},o.$watch("ngModel",function(e,t){o.init()}),o.$watch("paddingTop.value",function(e,t){o.ngModel.top=parseInt(e)}),o.$watch("paddingBottom.value",function(e,t){o.ngModel.bottom=parseInt(e)}),o.$watch("paddingLeft.value",function(e,t){o.ngModel.left=parseInt(e)}),o.$watch("paddingRight.value",function(e,t){o.ngModel.right=parseInt(e)}),o.$watch("paddingAll",function(e,t){if(NewsletterStudio.Utilities.isDefined(e)&&t!==e){var n=parseInt(e);o.ngModel.top=n,o.ngModel.bottom=n,o.ngModel.left=n,o.ngModel.right=n}}),o.init()},templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsMarginEditor/nsMarginEditor.html")}}])}(),angular.module("umbraco").directive("nsOnlyNumbers",function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){if(e){var t=e.replace(/[^0-9]/g,"");return t!==e&&(o.$setViewValue(t),o.$render()),t}})}}}),angular.module("umbraco").component("nsPreviewIframe",{template:"<div style='width:100%;height:100%;margin:0 auto;overflow:hidden;'><iframe id='resultFrame' src='about:blank' ng-src=\"{{vm.src}}\" frameborder='0'></iframe></div>",controller:["$element","$scope","angularHelper",function(t,e,n){function o(e){t.find("#resultFrame").css("background","none")}this.$postLink=function(){t.find("#resultFrame").on("load",o)}}],controllerAs:"vm",bindings:{src:"<",onLoaded:"&"}}),function(){"use strict";angular.module("umbraco").directive("nsTimeline",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsTimeline/nsTimeline.html"),scope:{date:"="},link:function(e,t,n){}}}])}(),function(){"use strict";angular.module("umbraco").directive("nsTimelineDate",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsTimeline/nsTimelineDate.html"),scope:{date:"="},link:function(e,t,n){}}}])}(),function(){"use strict";angular.module("umbraco").directive("nsTimelineItem",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsTimeline/nsTimelineItem.html"),scope:{timestamp:"=",type:"="},link:function(e,t,n){}}}])}(),function(){"use strict";angular.module("umbraco").directive("nsToggleButton",[function(){return{restrict:"E",require:"ngModel",scope:{ngModel:"=",options:"="},link:function(n,e,t,o){var r=[];n.options&&(n.options.forEach(function(e){var t;t="string"==typeof e?{text:e,value:e.toLowerCase(),selected:!1}:{text:e.text,value:e.value,tooltipKey:e.tooltipKey,selected:!1,icon:e.icon,iconSvg:e.iconSvg},r.push(t)}),n.toggleOptions=r),o.$render=function(){NewsletterStudio.Utilities.forEach(n.toggleOptions,function(e){e.value==n.ngModel?e.selected=!0:e.selected=!1})},n.selectOption=function(t){o.$setViewValue(t.value),n.toggleOptions.forEach(function(e){e.selected=e===t})}},templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsToggleButton/nsToggleButton.html")}}])}(),function(){"use strict";angular.module("umbraco").directive("nsUmbProperty",[function(){return{restrict:"E",transclude:!0,scope:{label:"@",description:"@"},templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsUmbProperty/nsUmbProperty.html")}}])}(),function(){"use strict";angular.module("umbraco").directive("nsValidationError",[function(){return{restrict:"E",require:"^form",transclude:!0,link:function(n,e,t,o){n.tempHide=!1,n.data=o,n.showError=!1,n.hide=function(){n.tempHide=!0},n.$watch(function(){var r=0;return o.$dirty&&r++,o.$submitted&&r++,angular.forEach(o.$error,function(e){for(var t in e){var n=e[t];for(var o in n.$error)r+=o.length}}),r},function(){var e=o[n.for];if(e)if(!0===e.$error[n.alias])n.tempHide=!1,n.showError=!0;else if(n.showError=!1,o.validationErrors&&0<o.validationErrors.length){var t=o.validationErrors.filter(function(e){return e.property===n.for&&e.errorAlias===n.alias}).shift();t&&o.validationErrors.splice(o.validationErrors.indexOf(t),1)}})},scope:{for:"@",alias:"@",key:"@"},templateUrl:NewsletterStudio.UmbracoFacade.getNsViewPath("/common/directives/nsValidationError/nsValidationError.html")}}])}(),angular.module("umbraco").directive("validateUrl",function(){return{require:"ngModel",link:function(e,t,n,o){o.$validators.url=function(e,t){return!!o.$isEmpty(e)||function(e){if(!1==(-1!==navigator.userAgent.indexOf("MSIE")||-1<navigator.appVersion.indexOf("Trident/")))try{new URL(e)}catch(e){return!1}return"http://"===e.substring(0,7).toLowerCase()||"https://"===e.substring(0,8).toLowerCase()}(t)}}}});